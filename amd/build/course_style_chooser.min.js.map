{"version":3,"sources":["../src/course_style_chooser.js"],"names":["define","$","ajax","notification","str","ModalFactory","ModalEvents","_root","_courseid","_headerstyle","_element","SELECTORS","HEADER","HEADER_TOP","HDRSTYLEA_BTN","HDRSTYLEB_BTN","_setGlobals","root","courseid","headerstyle","_registerEventListeners","on","_chooseStyle","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","getRoot","cancel","save","_styleChange","show","attr","removeClass","prop","addClass","args","ajaxCall","methodname","done","_choiceDone","fail","exception","call","get_string","_createSuccessPopup","text","popup","css","dismissBtn","html","append","setTimeout","fadeTo","slideUp","remove","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - Code for course header image uploader.\n *\n * @package    theme_uofr_conservatory\n * @author     John Lane\n *\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str',\n    'core/modal_factory', 'core/modal_events'], function($, ajax, notification, str, ModalFactory, ModalEvents) {\n\n    /** Container jquery object. */\n    var _root;\n    /** Course ID */\n    var _courseid;\n    /** Selected Header style. */\n    var _headerstyle;\n    var _element;\n\n    /** Jquery selector strings. */\n    var SELECTORS = {\n        HEADER: '#page-header .header-body',\n        HEADER_TOP: \"#page-header .page-head\",\n        HDRSTYLEA_BTN: '#hdr_chooser_a',\n        HDRSTYLEB_BTN: '#hdr_chooser_b',\n    };\n\n    /**\n     * Initializes global variables.\n     * @param {string} root - Jquery selector for container.\n     * @param {int} headerstyle - selected header style.\n     * @param {int} courseid - ID of current course.\n     * @return void\n     */\n    var _setGlobals = function(root, courseid, headerstyle) {\n       _root = $(root);\n       _courseid = courseid;\n       _headerstyle = headerstyle;\n    };\n\n    /**\n     * Sets up event listeners.\n     * @return void\n     */\n    var _registerEventListeners = function() {\n        _root.on('click', SELECTORS.HDRSTYLEA_BTN, _chooseStyle);\n        _root.on('click', SELECTORS.HDRSTYLEB_BTN, _chooseStyle);\n    };\n\n\n    /**\n     * Initiate ajax call to upload and set new image.\n     */\n    var _chooseStyle = function() {\n        _element = $(this);\n\n        //if current style is clicked, do nothing...\n        /*\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEA_BTN && _headerstyle == 0) {\n            return;\n        } else if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN && _headerstyle == 1) {\n            return;\n        }\n        */\n\n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: 'Change Course Header Style',\n            body: \"<p><b>Are you sure you want to change the course header style?</b><br />\"\n                  + \"Confirmation is required to ensure the course header style isn't changed accidentally.</p>\"\n        })\n        .then(function(modal) {\n            modal.setSaveButtonText('Change');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n            root.on(ModalEvents.save, _styleChange);\n            modal.show();\n        });\n    };\n\n\n    var _styleChange = function() {\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN) {\n\n            _headerstyle = 1;\n\n            $(SELECTORS.HDRSTYLEA_BTN).removeClass('btn-success');\n            $(SELECTORS.HDRSTYLEA_BTN).prop('disabled',false);\n\n            $(SELECTORS.HDRSTYLEB_BTN).addClass('btn-success');\n            $(SELECTORS.HDRSTYLEB_BTN).prop('disabled',true);\n\n            //bkgimg = $('#hdr_chooser_a_div img').attr('src');\n            $('#hdr_chooser_a_div').addClass('d-none');\n            $('#hdr_chooser_b_div').removeClass('style-a');\n\n            $('#header_a_head').attr('id','header_b_head');\n\n        } else {\n\n            _headerstyle = 0;\n\n            $(SELECTORS.HDRSTYLEB_BTN).removeClass('btn-success');\n            $(SELECTORS.HDRSTYLEB_BTN).prop('disabled',false);\n\n            $(SELECTORS.HDRSTYLEA_BTN).addClass('btn-success');\n            $(SELECTORS.HDRSTYLEA_BTN).prop('disabled',true);\n\n            $('#hdr_chooser_a_div').removeClass('d-none');\n            $('#hdr_chooser_b_div').addClass('style-a');\n\n            $('#header_b_head').attr('id','header_a_head');\n\n        }\n\n        // return if required values aren't set\n        if (!_courseid) {\n            return;\n        }\n\n        // set args\n        var args = {\n            courseid: _courseid,\n            headerstyle: _headerstyle,\n        };\n\n        // set ajax call\n        var ajaxCall = {\n            methodname: 'theme_uofr_conservatory_header_choose_style',\n            args: args,\n            done: _choiceDone,\n            fail: notification.exception\n        };\n\n        // initiate ajax call\n        ajax.call([ajaxCall]);\n    };\n    /**\n     * Handles theme_uofr_conservatory_upload_course_image response data.\n     * @param {Object} response \n     */\n    var _choiceDone = function() {\n        str.get_string('success:coursestylechosen', 'theme_uofr_conservatory')\n            .done(_createSuccessPopup);\n    };\n\n    /**\n     * Creates a bootstrap dismissable containing success text.\n     * Dismissable should appear in header and should cover upload button.\n     * @param {string} text Success text.\n     */\n    var _createSuccessPopup = function(text) {\n        // create bootstrap 4 dismissable\n        var popup = $('<div></div>');\n        popup.text(text);\n        popup.prop('id','cstyle_success_popup');\n        popup.css({'position' : 'absolute'});\n        popup.css({'right' : '5px'});\n        popup.css({'bottom' : '30px'});\n        popup.css({'z-index' : '1200'});\n        popup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var dismissBtn = $('<button></button>');\n        dismissBtn.html('&times;');\n        dismissBtn.addClass('close');\n        dismissBtn.attr('type', 'button');\n        dismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        popup.append(dismissBtn);\n\n        // add to header's course image area\n        $(SELECTORS.HEADER_TOP).append(popup);\n\n        // makes the alert disapear after a set amout of time.\n        setTimeout(function() {\n            $('#cstyle_success_popup').fadeTo(500, 0).slideUp(500, function(){\n                $(this).remove();\n            });\n        },1800);\n    };\n\n    /**\n     * Entry point to module. Sets globals and registers event listeners.\n     * @param {String} root Jquery selector for container.\n     * @return void\n     */\n    var init = function(root, courseid, headerstyle) {\n        _setGlobals(root, courseid, headerstyle);\n        _registerEventListeners();\n    };\n\n    return {\n        init: init\n    };\n\n});"],"file":"course_style_chooser.min.js"}