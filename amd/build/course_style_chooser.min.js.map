{"version":3,"file":"course_style_chooser.min.js","sources":["../src/course_style_chooser.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - Code for course header image uploader.\n *\n * @package    theme_urcourses_default\n * @author     John Lane\n *\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str',\n    'core/modal_factory', 'core/modal_events'], function($, ajax, notification, str, ModalFactory, ModalEvents) {\n\n    /** Container jquery object. */\n    var _root;\n    /** Course ID */\n    var _courseid;\n    /** Selected Header style. */\n    var _headerstyle;\n    var _element;\n\n    /** Jquery selector strings. */\n    var SELECTORS = {\n        HEADER: '#page-header .header-body',\n        HEADER_TOP: \"#page-header .page-head\",\n        HDRSTYLEA_BTN: '#hdr_chooser_a',\n        HDRSTYLEB_BTN: '#hdr_chooser_b',\n    };\n\n    /**\n     * Initializes global variables.\n     * @param {string} root - Jquery selector for container.\n     * @param {int} headerstyle - selected header style.\n     * @param {int} courseid - ID of current course.\n     * @return void\n     */\n    var _setGlobals = function(root, courseid, headerstyle) {\n       _root = $(root);\n       _courseid = courseid;\n       _headerstyle = headerstyle;\n    };\n\n    /**\n     * Sets up event listeners.\n     * @return void\n     */\n    var _registerEventListeners = function() {\n        _root.on('click', SELECTORS.HDRSTYLEA_BTN, _chooseStyle);\n        _root.on('click', SELECTORS.HDRSTYLEB_BTN, _chooseStyle);\n    };\n\n\n    /**\n     * Initiate ajax call to upload and set new image.\n     */\n    var _chooseStyle = function() {\n        _element = $(this);\n\n        //if current style is clicked, do nothing...\n        /*\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEA_BTN && _headerstyle == 0) {\n            return;\n        } else if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN && _headerstyle == 1) {\n            return;\n        }\n        */\n\n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: 'Change Course Header Style',\n            body: \"<p><b>Are you sure you want to change the course header style?</b><br />\"\n                  + \"Confirmation is required to ensure the course header style isn't changed accidentally.</p>\"\n        })\n        .then(function(modal) {\n            modal.setSaveButtonText('Change');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n            root.on(ModalEvents.save, _styleChange);\n            modal.show();\n        });\n    };\n\n\n    var _styleChange = function() {\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN) {\n\n            _headerstyle = 1;\n\n            $(SELECTORS.HDRSTYLEA_BTN).removeClass('btn-success');\n            $(SELECTORS.HDRSTYLEA_BTN).prop('disabled',false);\n\n            $(SELECTORS.HDRSTYLEB_BTN).addClass('btn-success');\n            $(SELECTORS.HDRSTYLEB_BTN).prop('disabled',true);\n\n            //bkgimg = $('#hdr_chooser_a_div img').attr('src');\n            $('#hdr_chooser_a_div').addClass('d-none');\n            $('#hdr_chooser_b_div').removeClass('style-a');\n\n            $('#header_a_head').attr('id','header_b_head');\n\n        } else {\n\n            _headerstyle = 0;\n\n            $(SELECTORS.HDRSTYLEB_BTN).removeClass('btn-success');\n            $(SELECTORS.HDRSTYLEB_BTN).prop('disabled',false);\n\n            $(SELECTORS.HDRSTYLEA_BTN).addClass('btn-success');\n            $(SELECTORS.HDRSTYLEA_BTN).prop('disabled',true);\n\n            $('#hdr_chooser_a_div').removeClass('d-none');\n            $('#hdr_chooser_b_div').addClass('style-a');\n\n            $('#header_b_head').attr('id','header_a_head');\n\n        }\n\n        // return if required values aren't set\n        if (!_courseid) {\n            return;\n        }\n\n        // set args\n        var args = {\n            courseid: _courseid,\n            headerstyle: _headerstyle,\n        };\n\n        // set ajax call\n        var ajaxCall = {\n            methodname: 'theme_urcourses_default_header_choose_style',\n            args: args,\n            done: _choiceDone,\n            fail: notification.exception\n        };\n\n        // initiate ajax call\n        ajax.call([ajaxCall]);\n    };\n    /**\n     * Handles theme_urcourses_default_upload_course_image response data.\n     * @param {Object} response\n     */\n    var _choiceDone = function() {\n        str.get_string('success:coursestylechosen', 'theme_urcourses_default')\n            .done(_createSuccessPopup);\n    };\n\n    /**\n     * Creates a bootstrap dismissable containing success text.\n     * Dismissable should appear in header and should cover upload button.\n     * @param {string} text Success text.\n     */\n    var _createSuccessPopup = function(text) {\n        // create bootstrap 4 dismissable\n        var popup = $('<div></div>');\n        popup.text(text);\n        popup.prop('id','cstyle_success_popup');\n        popup.css({'position' : 'absolute'});\n        popup.css({'right' : '5px'});\n        popup.css({'bottom' : '30px'});\n        popup.css({'z-index' : '1200'});\n        popup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var dismissBtn = $('<button></button>');\n        dismissBtn.html('&times;');\n        dismissBtn.addClass('close');\n        dismissBtn.attr('type', 'button');\n        dismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        popup.append(dismissBtn);\n\n        // add to header's course image area\n        $(SELECTORS.HEADER_TOP).append(popup);\n\n        // makes the alert disapear after a set amout of time.\n        setTimeout(function() {\n            $('#cstyle_success_popup').fadeTo(500, 0).slideUp(500, function(){\n                $(this).remove();\n            });\n        },1800);\n    };\n\n    /**\n     * Entry point to module. Sets globals and registers event listeners.\n     * @param {String} root Jquery selector for container.\n     * @return void\n     */\n    var init = function(root, courseid, headerstyle) {\n        _setGlobals(root, courseid, headerstyle);\n        _registerEventListeners();\n    };\n\n    return {\n        init: init\n    };\n\n});"],"names":["define","$","ajax","notification","str","ModalFactory","ModalEvents","_root","_courseid","_headerstyle","_element","SELECTORS","_chooseStyle","this","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","root","getRoot","on","cancel","save","_styleChange","show","attr","removeClass","prop","addClass","ajaxCall","methodname","args","courseid","headerstyle","done","_choiceDone","fail","exception","call","get_string","_createSuccessPopup","text","popup","css","dismissBtn","html","append","setTimeout","fadeTo","slideUp","remove","init","_setGlobals"],"mappings":"AAuBAA,sDAAO,CAAC,SAAU,YAAa,oBAAqB,WAChD,qBAAsB,sBAAsB,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,aAAcC,iBAG3FC,MAEAC,UAEAC,aACAC,SAGAC,qBAEY,0BAFZA,wBAGe,iBAHfA,wBAIe,iBA6BfC,aAAe,WACfF,SAAWT,EAAEY,MAYbR,aAAaS,OAAO,CAChBC,KAAMV,aAAaW,MAAMC,YACzBC,MAAO,6BACPC,KAAM,uKAGTC,MAAK,SAASC,OACXA,MAAMC,kBAAkB,cACpBC,KAAOF,MAAMG,UACjBD,KAAKE,GAAGnB,YAAYoB,QAAQ,eAG5BH,KAAKE,GAAGnB,YAAYqB,KAAMC,cAC1BP,MAAMQ,WAKVD,aAAe,cACX,IAAIlB,SAASoB,KAAK,OAASnB,yBAE3BF,aAAe,EAEfR,EAAEU,yBAAyBoB,YAAY,eACvC9B,EAAEU,yBAAyBqB,KAAK,YAAW,GAE3C/B,EAAEU,yBAAyBsB,SAAS,eACpChC,EAAEU,yBAAyBqB,KAAK,YAAW,GAG3C/B,EAAE,sBAAsBgC,SAAS,UACjChC,EAAE,sBAAsB8B,YAAY,WAEpC9B,EAAE,kBAAkB6B,KAAK,KAAK,mBAI9BrB,aAAe,EAEfR,EAAEU,yBAAyBoB,YAAY,eACvC9B,EAAEU,yBAAyBqB,KAAK,YAAW,GAE3C/B,EAAEU,yBAAyBsB,SAAS,eACpChC,EAAEU,yBAAyBqB,KAAK,YAAW,GAE3C/B,EAAE,sBAAsB8B,YAAY,UACpC9B,EAAE,sBAAsBgC,SAAS,WAEjChC,EAAE,kBAAkB6B,KAAK,KAAK,kBAK7BtB,eAWD0B,SAAW,CACXC,WAAY,8CACZC,KARO,CACPC,SAAU7B,UACV8B,YAAa7B,cAOb8B,KAAMC,YACNC,KAAMtC,aAAauC,WAIvBxC,KAAKyC,KAAK,CAACT,aAMXM,YAAc,WACdpC,IAAIwC,WAAW,4BAA6B,2BACvCL,KAAKM,sBAQVA,oBAAsB,SAASC,UAE3BC,MAAQ9C,EAAE,eACd8C,MAAMD,KAAKA,MACXC,MAAMf,KAAK,KAAK,wBAChBe,MAAMC,IAAI,UAAc,aACxBD,MAAMC,IAAI,OAAW,QACrBD,MAAMC,IAAI,QAAY,SACtBD,MAAMC,IAAI,WAAa,SACvBD,MAAMd,SAAS,uDAGXgB,WAAahD,EAAE,qBACnBgD,WAAWC,KAAK,WAChBD,WAAWhB,SAAS,SACpBgB,WAAWnB,KAAK,OAAQ,UACxBmB,WAAWnB,KAAK,eAAgB,SAGhCiB,MAAMI,OAAOF,YAGbhD,EAAEU,sBAAsBwC,OAAOJ,OAG/BK,YAAW,WACPnD,EAAE,yBAAyBoD,OAAO,IAAK,GAAGC,QAAQ,KAAK,WACnDrD,EAAEY,MAAM0C,cAEd,aAaC,CACHC,KANO,SAASjC,KAAMc,SAAUC,cA7JlB,SAASf,KAAMc,SAAUC,aACxC/B,MAAQN,EAAEsB,MACVf,UAAY6B,SACZ5B,aAAe6B,YA2JdmB,CAAYlC,KAAMc,SAAUC,aAnJ5B/B,MAAMkB,GAAG,QAASd,wBAAyBC,cAC3CL,MAAMkB,GAAG,QAASd,wBAAyBC"}