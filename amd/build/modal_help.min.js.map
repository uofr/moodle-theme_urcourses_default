{"version":3,"file":"modal_help.min.js","sources":["../src/modal_help.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - ModalHelp class\n *\n * @package    theme_urcourses_default\n * @author     John Lane\n *\n */\n\nimport $ from 'jquery';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport CustomEvents from 'core/custom_interaction_events';\nimport KeyCodes from 'core/key_codes';\nimport Modal from 'core/modal';\nimport ModalEvents from 'core/modal_events';\nimport ModalRegistry from 'core/modal_registry';\nimport ModalHelpAjax from 'theme_urcourses_default/modal_help_ajax';\nimport FuzzySearch from 'theme_urcourses_default/fuzzysearch';\n\nconst SELECTORS = {\n    SEARCH: '#modal_help_search',\n    SEARCH_BUTTON: '#modal_help_search_btn',\n    SEARCH_CLEAR: '#modal_help_search_clear',\n    SUGGESTIONS: '#modal_help_search_suggestions',\n    SUGGESTION_ITEM: '.modal-help-suggestion-item',\n    SEARCH_RESULT: '.modal-help-search-result',\n    BREADCRUMBS: '#breadcrumbs',\n    BREADCRUMB: '.breadcrumb-item a',\n    BREADCRUMB_SEARCH: '#breadcrumb_search',\n    BREADCRUMB_HOME: '#breadcrumb_home',\n    BREADCRUMB_PAGE: '#breadcrumb_page',\n    GUIDE_PAGE_LINK: '[data-region=\"guide-page-content\"] a',\n    OVERLAY_LOADING: '.overlay-icon-container',\n    BACK: '[data-action=\"go-back\"]',\n    BACK_TO_TOP: '#modal-help-back-to-top',\n    MAIN: '[data-region=\"modal-help-main\"]'\n};\n\nconst TEMPLATES = {\n    MODAL_HELP_GUIDE_PAGE: 'theme_urcourses_default/modal_help_guide_page',\n    MODAL_HELP_SEARCH_RESULTS: 'theme_urcourses_default/modal_help_search_results',\n    MODAL_HELP_LINKS_PAGE: 'theme_urcourses_default/modal_help_links',\n    OVERLAY_LOADING: 'core/overlay_loading'\n};\n\n/**\n * UR Courses help modal.\n *\n * @class ModalHelp\n * @property {Number} contextId Context ID number.\n * @property {Array} topicList Array of help topics.\n * @property {Array} topicTitles Titles of help topics.\n * @property {Object} searchBox Search input.\n * @property {Object} searchButton Search submit.\n * @property {Object} searchClear Clears search value.\n * @property {Object} suggestionBox Predictive search suggestion list.\n * @property {Object} suggestionItemIndex suggestionBox item index.\n */\nexport default class ModalHelp extends Modal {\n\n    constructor(root) {\n        super(root);\n        this.contextId = null;\n        this.topicList = null;\n        this.topicTitles = null;\n        this.searchBox = this.modal.find(SELECTORS.SEARCH);\n        this.searchButton = this.modal.find(SELECTORS.SEARCH_BUTTON);\n        this.searchClear = this.modal.find(SELECTORS.SEARCH_CLEAR);\n        this.suggestionBox = this.modal.find(SELECTORS.SUGGESTIONS);\n        this.content = this.modal.find(SELECTORS.MAIN);\n        this.suggestionItemIndex = 0;\n        this.currentPath = '';\n        this.history = [];\n        this.landingPageUrl = '';\n        this.userIsInstructor = null;\n    }\n\n    /**\n     * Setup for topic list, home page, and events.\n     *\n     * @param {Number} contextId Context ID number.\n     * @param {String} localUrl The local path relative to the site root.\n     */\n    async init(contextId, localUrl) {\n        try {\n            this.contextId = contextId;\n            [this.topicList, this.landingPageUrl, this.userIsInstructor] = await Promise.all([\n                this.getTopicList(),\n                ModalHelpAjax.getLandingPageUrl(this.contextId, localUrl),\n                ModalHelpAjax.userIsInstructor()\n            ]);\n            this.topicTitles = this.topicList.map(topic => topic.title);\n            FuzzySearch.setDictionary(this.topicTitles);\n            this.initEvents();\n        } catch (error) {\n            Notification.exception(error);\n        }\n    }\n\n    /**\n     * Registers event listeners.\n     */\n    initEvents() {\n\n        // PREDICTIVE SEARCH EVENTS //\n\n        /** Update suggestion list based on input. */\n        this.searchBox.on('input', () => {\n            if (this.searchBox.val()) {\n                this.showSearchClear();\n            } else {\n                this.hideSearchClear();\n            }\n            this.updateSuggestions();\n        });\n\n        /** Show suggestion list when search box is in focus. */\n        this.searchBox.on('focus', () => {\n            this.updateSuggestions();\n        });\n\n        /** Clear search value if search clear button is clicked. */\n        this.searchClear.on('click', () => {\n            this.clearSearch();\n        });\n\n        /** Hide suggestions if user clicks away from search box. */\n        this.getRoot().on('click', (e) => {\n            if (e.target !== this.searchBox[0] && e.target !== this.suggestionBox[0]) {\n                this.hideSuggestionBox();\n            }\n        });\n\n        /** If user presses up or down while focused on search, focus on suggestions. */\n        this.searchBox.on('keydown', (e) => {\n            if (e.keyCode === KeyCodes.arrowUp || e.keyCode === KeyCodes.arrowLeft) {\n                e.preventDefault();\n                this.suggestionItemIndex = this.getSuggestionItems().length - 0;\n                this.getSuggestionItems().eq(this.suggestionItemIndex).focus();\n            }\n            else if (e.keyCode === KeyCodes.arrowDown || e.keyCode === KeyCodes.arrowRight) {\n                e.preventDefault();\n                this.suggestionItemIndex = -1;\n                this.getSuggestionItems().eq(this.suggestionItemIndex).focus();\n            }\n        });\n\n        /** If user is focused on suggestions, cycle through list. */\n        this.suggestionBox.on('keydown', SELECTORS.SUGGESTION_ITEM, (e) => {\n            if (e.keyCode === KeyCodes.arrowUp || e.keyCode === KeyCodes.arrowLeft) {\n                e.preventDefault();\n                this.suggestionItemIndex--;\n                if (this.suggestionItemIndex < -1) {\n                    this.suggestionItemIndex = this.getSuggestionItems().length - 0;\n                }\n                this.getSuggestionItems().eq(this.suggestionItemIndex).focus();\n            }\n            else if (e.keyCode === KeyCodes.arrowDown || e.keyCode === KeyCodes.arrowRight) {\n                e.preventDefault();\n                this.suggestionItemIndex++;\n                if (this.suggestionItemIndex >= this.getSuggestionItems().length) {\n                    this.suggestionItemIndex = -1;\n                }\n                this.getSuggestionItems().eq(this.suggestionItemIndex).focus();\n            }\n        });\n\n        // GUIDE PAGE EVENTS //\n\n        /** Show home page when modal is open. */\n        this.getRoot().on(ModalEvents.shown, () => {\n            this.renderGuidePage(this.landingPageUrl.url, this.landingPageUrl.target);\n        });\n\n        /** Reset modal to default when closed. */\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.resetModal();\n        });\n\n        /** Open suggestion page if user clicks or presses enter. */\n        this.suggestionBox.on(CustomEvents.events.activate, SELECTORS.SUGGESTION_ITEM, (e) => {\n            const suggestion = $(e.target);\n            const topicTitle = suggestion.attr('data-value');\n            const topicTitleLower = topicTitle.toLowerCase().replace(/&/g, '&amp;');\n            const topic = this.topicList.find(topic => topic.title.toLowerCase() === topicTitleLower);\n            const url = `${topic.url}.json`;\n            this.searchBox.val(topicTitle);\n            this.showSearchClear();\n            this.renderGuidePage(url);\n        });\n\n        /** Search on click. */\n        this.searchButton.on('click', () => {\n            const query = this.searchBox.val();\n            this.searchGuides(query);\n            this.hideSuggestionBox();\n        });\n\n        /** Search on enter. */\n        this.searchBox.on('keydown', (e) => {\n            if (e.keyCode === KeyCodes.enter) {\n                const query = this.searchBox.val();\n                this.searchGuides(query);\n                this.getModal().focus();\n                this.hideSuggestionBox();\n            }\n        });\n\n        /** Open search result. */\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.SEARCH_RESULT, (e) => {\n            const url = $(e.target).attr('data-url');\n            this.renderGuidePage(`${url}.json`);\n        });\n\n        /** If the user clicks a link inside the guide page, open the page. */\n        this.getRoot().on('click', SELECTORS.GUIDE_PAGE_LINK, (e) => {\n            let href = $(e.currentTarget).attr('href');\n            if (href.startsWith('#') ) {return;}\n            if (href.endsWith('/')) {href = href.substring(0, href.lastIndexOf('/'));}\n            e.preventDefault();\n            if (href.startsWith('http') || href.startsWith('https') || href.startsWith('mailto')) {\n                window.open(href, '_blank');\n            } else {\n                const [path, target] = href.split('#');\n                const hrefPath = path.split('/');\n                const actualPath = this.currentPath.split('/');\n                for (const node of hrefPath) {\n                    if (node === '..'){ actualPath.pop();}\n                    else if (node !== '.') {actualPath.push(node);}\n                }\n                const url = actualPath.join('/');\n                this.renderGuidePage(`${url}.json`, target);\n            }\n        });\n\n        this.getModal().on('click', SELECTORS.BREADCRUMB, (e) => {\n            e.preventDefault();\n            const breadcrumb = $(e.currentTarget);\n            const url = breadcrumb.attr('href');\n            const target = breadcrumb.attr('data-target');\n            this.renderGuidePage(url, target);\n        });\n\n        this.getModal().on('click', SELECTORS.BACK, (e) => {\n            e.preventDefault();\n            if (this.history.length > 1) {\n                this.history.pop();\n                const [url, target] = this.history.pop();\n                this.renderGuidePage(url, target);\n            }\n        });\n\n        $(this.getModal()).find(\".modal-body\").scroll(function () {\n            if ($(this).scrollTop() > 50) {\n                $(SELECTORS.BACK_TO_TOP).fadeIn();\n            } else {\n                $(SELECTORS.BACK_TO_TOP).fadeOut();\n            }\n        });\n\n        this.getModal().on('click', SELECTORS.BACK_TO_TOP, (e) => {\n             $(this.getModal()).find(\".modal-body\").animate({\n                        scrollTop: 0\n                }, 400);\n                    return false;\n        });\n    }\n    /**\n     * Get list of help topics.\n     * @return {Array} Array of topics.\n     */\n    async getTopicList() {\n        const {instructor, url} = await ModalHelpAjax.getTopicListUrl(this.contextId);\n        const topicListJson = await this.getJsonData(url);\n        const topics = topicListJson.jsondata.page_data[0].all_pages;\n        const topicsSorted = topics.sort((a, b) => a.title > b.title);\n        const prefix = instructor ? 'Instructor' : 'Students';\n        return topicsSorted.filter(topic => topic.prefix === prefix);\n    }\n\n    /**\n     * Updates the suggestion list based on whatever is in the search box.\n     */\n    updateSuggestions() {\n        const query = this.searchBox.val();\n        let suggestions = FuzzySearch.search(query);\n        if (!suggestions.length) {\n            suggestions = this.topicTitles;\n        }\n        const suggestionList = this.getSuggestions(suggestions);\n        this.suggestionBox.html('');\n        this.suggestionBox.append(suggestionList);\n        this.showSuggestionBox();\n    }\n\n    /**\n     * Returns html markup based on list of suggested words.\n     * @param {Array} suggestions - List of suggested words.\n     * @returns {Array} An array of html tags.\n     */\n    getSuggestions(suggestions) {\n        return suggestions.map(suggestion => `<a href=\"#\" class=\"modal-help-suggestion-item\"\n                                              data-value=\"${suggestion}\">${suggestion}</a>`);\n    }\n\n    /**\n     * Searches the guides and displays results.\n     * @param {String} query\n     */\n    async searchGuides(query) {\n        if (!query) {return;}\n        try {\n            await this.setLoading(true);\n            const searchUrl = await ModalHelpAjax.getSearchUrl(this.contextId, query);\n            const basePath = searchUrl.split('/');\n            basePath.pop();\n            basePath.pop();\n            const baseUrl = basePath.join('/');\n            const searchResults = await this.getJsonData(searchUrl);\n            const breadcrumbs = [\n                {\n                    active: false,\n                    name: this.userIsInstructor ? 'Instructor Guide' : 'Student Guides',\n                    url: this.userIsInstructor ? `${baseUrl}/instructor.json` : `${baseUrl}/student.json`,\n                    target: ''\n                },\n                {\n                    active: true,\n                    name: `Search Results: ${query}`,\n                    url: '',\n                    target: '',\n                }\n            ];\n            await this.renderReplace(TEMPLATES.MODAL_HELP_SEARCH_RESULTS,\n                {results: searchResults.jsondata,\n                    query: query,\n                    breadcrumbs: breadcrumbs}, this.content);\n            this.getBody()[0].scrollTop = 0;\n\n            this.history.push([searchUrl]);\n        } catch (error) {\n            Notification.exception(error);\n        } finally {\n            this.setLoading(false);\n        }\n    }\n\n    /**\n     * Load content from the url into the modal. Scroll to target if one is provided.\n     * @param {String} url Url to fetch from.\n     * @param {String} target Anchor to scroll to when url is loaded.\n     */\n    async renderGuidePage(url, target = '') {\n        try {\n            await this.setLoading(true);\n            const page = await this.getJsonData(url);\n            const breadcrumbs = [];\n            const {content, frontmatter, jsondata} = page;\n            const {title} = frontmatter ? frontmatter : jsondata.page_data[0];\n            const path = url.split('/');\n\n            breadcrumbs.unshift({\n                active: true,\n                name: title,\n                target: target,\n                url: url,\n            });\n            path.pop();\n            while (path[path.length - 1] !== 'guides') {\n                const breadcrumbUrl = `${path.join('/')}.json`;\n                const breadcrumbPage = await this.getJsonData(breadcrumbUrl);\n                const {frontmatter, jsondata} = breadcrumbPage;\n                const {title} = frontmatter ? frontmatter : jsondata.page_data[0];\n                breadcrumbs.unshift({\n                    active: false,\n                    name: title,\n                    url: breadcrumbUrl\n                });\n                path.pop();\n            }\n\n            const guidesBase = path.join('/');\n\n            if (this.userIsInstructor && breadcrumbs[0].name !== 'Instructor Guide') {\n                breadcrumbs.unshift({\n                    active: false,\n                    name: 'Instructor Guide',\n                    url: `${guidesBase}/instructor.json`\n                });\n            }\n            if (!this.userIsInstructor && breadcrumbs[0].name !== 'Student Guides') {\n                breadcrumbs.unshift({\n                    active: false,\n                    name: 'Student Guides',\n                    url: `${guidesBase}/student.json`\n                });\n            }\n\n            let html = content ? content : jsondata.page_data[0].content;\n            html = html.replaceAll('src=\"assets', `src=\"${guidesBase}/assets`);\n            html = html.replaceAll('src=\"../assets', `src=\"${guidesBase}/assets`);\n            html = html.replaceAll('src=\"./images', `src=\"${guidesBase}/images`);\n            var back =false;\n            if (this.history.length > 0) {\n                back =true;\n            }\n\n            if(!$(this.header).find(\".modal-help-links\").length){\n                await this.renderAppend(TEMPLATES.MODAL_HELP_LINKS_PAGE,\n                    {isinstructor:this.userIsInstructor},\n                    $(this.header).find(\".modal-help-header\"));\n            }\n            await this.renderReplace(TEMPLATES.MODAL_HELP_GUIDE_PAGE,\n                {html: html,\n                breadcrumbs: breadcrumbs,\n                isinstructor:this.userIsInstructor,\n                back:back}, this.content);\n            this.currentPath = url.substring(0, url.lastIndexOf('/'));\n            if (target) {\n                const anchor = target.startsWith('#') ? $(target) : $(`#${target}`);\n                if (anchor.length){ anchor[0].scrollIntoView();}\n            }else {this.getBody()[0].scrollTop = 0;}\n\n            this.history.push([url, target]);\n        } catch (error) {\n            Notification.exception(error);\n        } finally {\n            this.setLoading(false);\n        }\n    }\n\n    /**\n     * Fetches from url and returns json.\n     * @param {String} url Url to fetch from.\n     */\n    async getJsonData(url) {\n        const response = await fetch(url);\n        return response.json();\n    }\n\n    /**\n     * Appends a loading spinner to modal if loading is true, removes spinner if false.\n     * @param {Boolean} loading True for loading, contentfalse for not-loading.\n     */\n    setLoading(loading) {\n        if (loading) {\n            return this.renderAppend(TEMPLATES.OVERLAY_LOADING, {visible: true}, this.content);\n        } else {\n            this.getBody().find(SELECTORS.OVERLAY_LOADING).remove();\n        }\n    }\n\n    /**\n     * Render template using data and replace area.\n     * @param {String} template Template to render.\n     * @param {Object} data Template data.\n     * @param {Object|String} area Selector or jquery object.\n     */\n    renderReplace(template, data, area) {\n        return Templates.render(template, data)\n            .then((html, js) => Templates.replaceNodeContents(area, html, js));\n    }\n\n    /**\n     * Render template using data and append to area.\n     * @param {String} template Template to render.\n     * @param {Object} data Template data.\n     * @param {Object|String} area Selector or jquery object.\n     */\n    renderAppend(template, data, area) {\n        return Templates.render(template, data)\n            .then((html, js) => Templates.appendNodeContents(area, html, js));\n    }\n\n    /**\n     * Resets modal content and search.\n     */\n    resetModal() {\n        this.content.html('');\n        this.searchBox.val('');\n        this.suggestionBox.html('');\n    }\n\n    /**\n     * Clears whatever is in the search box.\n     */\n    clearSearch() {\n        this.searchBox.val('');\n        this.hideSearchClear();\n    }\n\n    /**\n     * Removes d-none class from suggestion box and scrolls to the top of the list.\n     */\n    showSuggestionBox() {\n        this.suggestionBox.removeClass('d-none');\n        this.suggestionBox[0].scrollTop = 0;\n    }\n\n    /**\n     * Adds d-none class to suggestion box.\n     */\n    hideSuggestionBox() {\n        this.suggestionBox.addClass('d-none');\n    }\n\n    /**\n     * Removes d-none class from clear search button.\n     */\n    showSearchClear() {\n        this.searchClear.removeClass('d-none');\n    }\n\n    /**\n     * Adds d-none class to clear search button.\n     */\n    hideSearchClear() {\n        this.searchClear.addClass('d-none');\n    }\n\n    /**\n     * Returns an array of suggestions in the suggestion box.\n     * @returns {JQuery}\n     */\n    getSuggestionItems() {\n        return this.suggestionBox.find(SELECTORS.SUGGESTION_ITEM);\n    }\n\n    /**\n     * Returns modal type. Used when creating the modal using ModalFactory.\n     * @returns {String}\n     */\n    static getType() {\n        return 'theme_urcourses_default-help';\n    }\n}\n\n// Setup code for adding ModalHelp to the modal factory.\nlet registered = false;\nif (!registered) {\n    ModalRegistry.register(ModalHelp.getType(), ModalHelp, 'theme_urcourses_default/modal_help');\n    registered = true;\n}\n\n"],"names":["_jquery","_interopRequireDefault","_notification","_templates","_custom_interaction_events","_key_codes","_modal","_modal_events","_modal_registry","_modal_help_ajax","_fuzzysearch","SELECTORS","TEMPLATES","ModalHelp","_getJsonData","_renderGuidePage","_searchGuides","_getTopicList","root","_this","_classCallCheck","this","_super","call","contextId","topicList","topicTitles","searchBox","modal","find","searchButton","searchClear","suggestionBox","content","suggestionItemIndex","currentPath","history","landingPageUrl","userIsInstructor","localUrl","_yield$Promise$all","_yield$Promise$all2","regeneratorRuntime","wrap","_context","prev","next","Promise","all","getTopicList","ModalHelpAjax","getLandingPageUrl","sent","_slicedToArray","map","topic","title","setDictionary","initEvents","t0","Notification","exception","stop","_callee","_this2","on","val","showSearchClear","hideSearchClear","updateSuggestions","clearSearch","getRoot","e","target","hideSuggestionBox","keyCode","KeyCodes","arrowUp","arrowLeft","preventDefault","getSuggestionItems","length","eq","focus","arrowDown","arrowRight","ModalEvents","shown","renderGuidePage","url","hidden","resetModal","CustomEvents","events","activate","topicTitle","default","attr","topicTitleLower","toLowerCase","replace","concat","query","searchGuides","enter","getModal","href","currentTarget","startsWith","endsWith","substring","lastIndexOf","window","open","_step","_href$split2","split","path","hrefPath","actualPath","_iterator","_createForOfIteratorHelper","s","n","done","node","value","pop","push","err","f","join","breadcrumb","_this2$history$pop2","scroll","scrollTop","fadeIn","fadeOut","animate","_asyncToGenerator","mark","_callee2","_yield$ModalHelpAjax$","instructor","topicListJson","topics","topicsSorted","prefix","_context2","getTopicListUrl","getJsonData","jsondata","page_data","all_pages","sort","a","b","abrupt","filter","suggestions","FuzzySearch","search","suggestionList","getSuggestions","html","append","showSuggestionBox","suggestion","_callee3","searchUrl","basePath","baseUrl","searchResults","breadcrumbs","_context3","setLoading","getSearchUrl","active","name","renderReplace","results","getBody","finish","_callee4","page","frontmatter","_ref","breadcrumbUrl","breadcrumbPage","_frontmatter","_jsondata","_ref2","_title","guidesBase","back","anchor","_args4","arguments","_context4","unshift","replaceAll","header","renderAppend","isinstructor","scrollIntoView","_callee5","response","_context5","fetch","json","loading","visible","remove","template","data","area","Templates","render","then","js","replaceNodeContents","appendNodeContents","removeClass","addClass","Modal","registered","register","getType"],"mappings":"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"}