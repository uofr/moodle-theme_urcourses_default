{"version":3,"file":"toggle_course_availability.min.js","sources":["../src/toggle_course_availability.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - Code for course header image uploader.\n *\n * @package    theme_urcourses_default\n * @author     John Lane\n *\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str',\n    'core/modal_factory', 'core/modal_events'], function($, ajax, notification, str, ModalFactory, ModalEvents) {\n\n    /** Container jquery object. */\n    var _root;\n    /** Course ID */\n    var _courseid;\n    var _availability;\n\n    /** Jquery selector strings. */\n    var SELECTORS = {\n        HEADER: '#page-header .header-body',\n        HEADER_TOP: \"#page-header .page-head\",\n        HDRMAKEAVAIL_BTN: '#avail_btn',\n    };\n\n    /**\n     * Initializes global variables.\n     * @param {string} root - Jquery selector for container.\n     * @param {int} availability - course visible\n     * @param {int} courseid - ID of current course.\n     * @return void\n     */\n    var _setGlobals = function(root, courseid, availability) {\n       _root = $(root);\n       _courseid = courseid;\n       _availability = availability;\n    };\n\n    /**\n     * Sets up event listeners.\n     * @return void\n     */\n    var _registerEventListeners = function() {\n        _root.on('click', SELECTORS.HDRMAKEAVAIL_BTN, _toggleAvailability);\n    };\n\n\n    /**\n     * Initiate ajax call to upload and set new image.\n     */\n    var _toggleAvailability = function() {\n\n        //if current style is clicked, do nothing...\n        /*\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEA_BTN && _headerstyle == 0) {\n            return;\n        } else if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN && _headerstyle == 1) {\n            return;\n        }\n        */\n\n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: '<b>Make this course '+(_availability==1?'un':'')+'available?</b>',\n            body: \"<p>Are you sure you want to make this course <b>\"+(_availability==1?'un':'')\n            +\"available</b> to students?</b><br /><span class=\\\"small\\\">\"\n            +\"You can change the availability of this course as needed, when you're ready.</span></p>\"\n        })\n        .then(function(modal) {\n            modal.setSaveButtonText('Yes, make it '+(_availability==1?'un':'')\n            +'available');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n            root.on(ModalEvents.save, _availabilityChange);\n            modal.show();\n        });\n    };\n\n\n    var _availabilityChange = function() {\n\n        // return if required values aren't set\n        if (!_courseid) {\n            return;\n        }\n\n        // set args\n        var args = {\n            courseid: _courseid,\n            availability: _availability,\n        };\n\n        // set ajax call\n        var ajaxCall = {\n            methodname: 'theme_urcourses_default_toggle_course_availability',\n            args: args,\n            done: _choiceDone,\n            fail: notification.exception\n        };\n\n        // initiate ajax call\n        ajax.call([ajaxCall]);\n    };\n    /**\n     * Handles theme_urcourses_default_upload_course_image response data.\n     * @param {Object} response\n     */\n    var _choiceDone = function() {\n        str.get_string('success:courseavailabilitychanged', 'theme_urcourses_default')\n            .done(_createSuccessPopup);\n    };\n\n    /**\n     * Creates a bootstrap dismissable containing success text.\n     * Dismissable should appear in header and should cover upload button.\n     * @param {string} text Success text.\n     */\n    var _createSuccessPopup = function(text) {\n        // create bootstrap 4 dismissable\n        var popup = $('<div></div>');\n        popup.text(text);\n        popup.prop('id','cstyle_success_popup');\n        popup.css({'position' : 'absolute'});\n        popup.css({'right' : '5px'});\n        popup.css({'bottom' : '30px'});\n        popup.css({'z-index' : '1200'});\n        popup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var dismissBtn = $('<button></button>');\n        dismissBtn.html('&times;');\n        dismissBtn.addClass('close');\n        dismissBtn.attr('type', 'button');\n        dismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        popup.append(dismissBtn);\n\n        // add to header's course image area\n        $(SELECTORS.HEADER_TOP).append(popup);\n\n        var relotext = \"Loading\";\n\n        // create bootstrap 4 dismissable\n        var relopopup = $('<div></div>');\n        relopopup.text(relotext);\n        relopopup.prop('id','cstyle_success_popup');\n        relopopup.css({'position' : 'absolute'});\n        relopopup.css({'right' : '5px'});\n        relopopup.css({'bottom' : '30px'});\n        relopopup.css({'z-index' : '1200'});\n        relopopup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var relodismissBtn = $('<button></button>');\n        relodismissBtn.html('&times;');\n        relodismissBtn.addClass('close');\n        relodismissBtn.attr('type', 'button');\n        relodismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        relopopup.append(relodismissBtn);\n\n\n        // makes the alert disapear after a set amout of time.\n        setTimeout(function() {\n            $('#cstyle_success_popup').fadeTo(500, 0).slideUp(500, function(){\n                $(this).remove();\n                // add to header's course image area\n                $(SELECTORS.HEADER_TOP).append(relopopup);\n\n                location.reload(true);\n            });\n        },1800);\n    };\n\n    /**\n     * Entry point to module. Sets globals and registers event listeners.\n     * @param {String} root Jquery selector for container.\n     * @return void\n     */\n    var init = function(root, courseid, availability) {\n        _setGlobals(root, courseid, availability);\n        _registerEventListeners();\n    };\n\n    return {\n        init: init\n    };\n\n});"],"names":["define","$","ajax","notification","str","ModalFactory","ModalEvents","_root","_courseid","_availability","SELECTORS","_toggleAvailability","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","root","getRoot","on","cancel","save","_availabilityChange","show","ajaxCall","methodname","args","courseid","availability","done","_choiceDone","fail","exception","call","get_string","_createSuccessPopup","text","popup","prop","css","position","right","bottom","addClass","dismissBtn","html","attr","append","relotext","relopopup","relodismissBtn","setTimeout","fadeTo","slideUp","this","remove","location","reload","init","_setGlobals"],"mappings":"AAuBAA,OAAM,qDAAC,CAAC,SAAU,YAAa,oBAAqB,WAChD,qBAAsB,sBAAsB,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,aAAcC,aAG/F,IAAIC,MAEAC,UACAC,cAGAC,qBAEY,0BAFZA,2BAGkB,aA4BlBC,oBAAsB,WAYtBN,aAAaO,OAAO,CAChBC,KAAMR,aAAaS,MAAMC,YACzBC,MAAO,wBAAuC,GAAfP,cAAiB,KAAK,IAAI,iBACzDQ,KAAM,oDAAmE,GAAfR,cAAiB,KAAK,IAA1E,qJAITS,MAAK,SAASC,OACXA,MAAMC,kBAAkB,iBAAgC,GAAfX,cAAiB,KAAK,IAC9D,aACD,IAAIY,KAAOF,MAAMG,UACjBD,KAAKE,GAAGjB,YAAYkB,QAAQ,eAG5BH,KAAKE,GAAGjB,YAAYmB,KAAMC,qBAC1BP,MAAMQ,WAKVD,oBAAsB,WAGlB,GAAClB,UAAD,CAKJ,IAMIoB,SAAW,CACXC,WAAY,qDACZC,KARO,CACPC,SAAUvB,UACVwB,aAAcvB,eAOdwB,KAAMC,YACNC,KAAMhC,aAAaiC,WAIvBlC,KAAKmC,KAAK,CAACT,aAMXM,YAAc,WACd9B,IAAIkC,WAAW,oCAAqC,2BAC/CL,KAAKM,sBAQVA,oBAAsB,SAASC,MAE/B,IAAIC,MAAQxC,EAAE,eACdwC,MAAMD,KAAKA,MACXC,MAAMC,KAAK,KAAK,wBAChBD,MAAME,IAAI,CAAcC,SAAA,aACxBH,MAAME,IAAI,CAAWE,MAAA,QACrBJ,MAAME,IAAI,CAAYG,OAAA,SACtBL,MAAME,IAAI,CAAa,UAAA,SACvBF,MAAMM,SAAS,mDAGf,IAAIC,WAAa/C,EAAE,qBACnB+C,WAAWC,KAAK,WAChBD,WAAWD,SAAS,SACpBC,WAAWE,KAAK,OAAQ,UACxBF,WAAWE,KAAK,eAAgB,SAGhCT,MAAMU,OAAOH,YAGb/C,EAAES,sBAAsByC,OAAOV,OAE3BW,IAGAC,UAAYpD,EAAE,eAClBoD,UAAUb,KAJK,WAKfa,UAAUX,KAAK,KAAK,wBACpBW,UAAUV,IAAI,CAAcC,SAAA,aAC5BS,UAAUV,IAAI,CAAWE,MAAA,QACzBQ,UAAUV,IAAI,CAAYG,OAAA,SAC1BO,UAAUV,IAAI,CAAa,UAAA,SAC3BU,UAAUN,SAAS,mDAGnB,IAAIO,eAAiBrD,EAAE,qBACvBqD,eAAeL,KAAK,WACpBK,eAAeP,SAAS,SACxBO,eAAeJ,KAAK,OAAQ,UAC5BI,eAAeJ,KAAK,eAAgB,SAGpCG,UAAUF,OAAOG,gBAIjBC,YAAW,WACPtD,EAAE,yBAAyBuD,OAAO,IAAK,GAAGC,QAAQ,KAAK,WACnDxD,EAAEyD,MAAMC,SAER1D,EAAES,sBAAsByC,OAAOE,WAE/BO,SAASC,QAAO,QAEtB,OAaC,MAAA,CACHC,KANO,SAASzC,KAAMU,SAAUC,eAxJlB,SAASX,KAAMU,SAAUC,cACxCzB,MAAQN,EAAEoB,MACVb,UAAYuB,SACZtB,cAAgBuB,aAsJf+B,CAAY1C,KAAMU,SAAUC,cA9I5BzB,MAAMgB,GAAG,QAASb,2BAA4BC"}