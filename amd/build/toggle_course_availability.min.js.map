{"version":3,"sources":["../src/toggle_course_availability.js"],"names":["define","$","ajax","notification","str","ModalFactory","ModalEvents","_root","_courseid","_availability","SELECTORS","HEADER","HEADER_TOP","HDRMAKEAVAIL_BTN","_setGlobals","root","courseid","availability","_registerEventListeners","on","_toggleAvailability","create","type","types","SAVE_CANCEL","title","body","then","modal","setSaveButtonText","getRoot","cancel","save","_availabilityChange","show","args","ajaxCall","methodname","done","_choiceDone","fail","exception","call","get_string","_createSuccessPopup","text","popup","prop","css","addClass","dismissBtn","html","attr","append","relopopup","relodismissBtn","setTimeout","fadeTo","slideUp","remove","location","reload","init"],"mappings":"AAuBAA,OAAM,sDAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mBAAxB,CAA6C,UAA7C,CACH,oBADG,CACmB,mBADnB,CAAD,CAC0C,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAAqCC,CAArC,CAAmDC,CAAnD,CAAgE,IAGxGC,CAAAA,CAHwG,CAKxGC,CALwG,CAMxGC,CANwG,CASxGC,CAAS,CAAG,CACZC,MAAM,CAAE,2BADI,CAEZC,UAAU,CAAE,yBAFA,CAGZC,gBAAgB,CAAE,YAHN,CAT4F,CAsBxGC,CAAW,CAAG,SAASC,CAAT,CAAeC,CAAf,CAAyBC,CAAzB,CAAuC,CACtDV,CAAK,CAAGN,CAAC,CAACc,CAAD,CAAT,CACAP,CAAS,CAAGQ,CAAZ,CACAP,CAAa,CAAGQ,CAClB,CA1B2G,CAgCxGC,CAAuB,CAAG,UAAW,CACrCX,CAAK,CAACY,EAAN,CAAS,OAAT,CAAkBT,CAAS,CAACG,gBAA5B,CAA8CO,CAA9C,CACH,CAlC2G,CAwCxGA,CAAmB,CAAG,UAAW,CAYjCf,CAAY,CAACgB,MAAb,CAAoB,CAChBC,IAAI,CAAEjB,CAAY,CAACkB,KAAb,CAAmBC,WADT,CAEhBC,KAAK,CAAE,wBAAuC,CAAf,EAAAhB,CAAa,CAAI,IAAJ,CAAS,EAA9C,EAAkD,gBAFzC,CAGhBiB,IAAI,CAAE,oDAAmE,CAAf,EAAAjB,CAAa,CAAI,IAAJ,CAAS,EAA1E,qJAHU,CAApB,EAOCkB,IAPD,CAOM,SAASC,CAAT,CAAgB,CAClBA,CAAK,CAACC,iBAAN,CAAwB,iBAAgC,CAAf,EAAApB,CAAa,CAAI,IAAJ,CAAS,EAAvC,EACvB,WADD,EAEA,GAAIM,CAAAA,CAAI,CAAGa,CAAK,CAACE,OAAN,EAAX,CACAf,CAAI,CAACI,EAAL,CAAQb,CAAW,CAACyB,MAApB,CAA4B,UAAU,CAErC,CAFD,EAGAhB,CAAI,CAACI,EAAL,CAAQb,CAAW,CAAC0B,IAApB,CAA0BC,CAA1B,EACAL,CAAK,CAACM,IAAN,EACH,CAhBD,CAiBH,CArE2G,CAwExGD,CAAmB,CAAG,UAAW,CAGjC,GAAI,CAACzB,CAAL,CAAgB,CACZ,MACH,CALgC,GAQ7B2B,CAAAA,CAAI,CAAG,CACPnB,QAAQ,CAAER,CADH,CAEPS,YAAY,CAAER,CAFP,CARsB,CAc7B2B,CAAQ,CAAG,CACXC,UAAU,CAAE,oDADD,CAEXF,IAAI,CAAEA,CAFK,CAGXG,IAAI,CAAEC,CAHK,CAIXC,IAAI,CAAErC,CAAY,CAACsC,SAJR,CAdkB,CAsBjCvC,CAAI,CAACwC,IAAL,CAAU,CAACN,CAAD,CAAV,CACH,CA/F2G,CAoGxGG,CAAW,CAAG,UAAW,CACzBnC,CAAG,CAACuC,UAAJ,CAAe,mCAAf,CAAoD,yBAApD,EACKL,IADL,CACUM,CADV,CAEH,CAvG2G,CA8GxGA,CAAmB,CAAG,SAASC,CAAT,CAAe,CAErC,GAAIC,CAAAA,CAAK,CAAG7C,CAAC,CAAC,aAAD,CAAb,CACA6C,CAAK,CAACD,IAAN,CAAWA,CAAX,EACAC,CAAK,CAACC,IAAN,CAAW,IAAX,CAAgB,sBAAhB,EACAD,CAAK,CAACE,GAAN,CAAU,CAAC,SAAa,UAAd,CAAV,EACAF,CAAK,CAACE,GAAN,CAAU,CAAC,MAAU,KAAX,CAAV,EACAF,CAAK,CAACE,GAAN,CAAU,CAAC,OAAW,MAAZ,CAAV,EACAF,CAAK,CAACE,GAAN,CAAU,CAAC,UAAY,MAAb,CAAV,EACAF,CAAK,CAACG,QAAN,CAAe,iDAAf,EAGA,GAAIC,CAAAA,CAAU,CAAGjD,CAAC,CAAC,mBAAD,CAAlB,CACAiD,CAAU,CAACC,IAAX,CAAgB,SAAhB,EACAD,CAAU,CAACD,QAAX,CAAoB,OAApB,EACAC,CAAU,CAACE,IAAX,CAAgB,MAAhB,CAAwB,QAAxB,EACAF,CAAU,CAACE,IAAX,CAAgB,cAAhB,CAAgC,OAAhC,EAGAN,CAAK,CAACO,MAAN,CAAaH,CAAb,EAGAjD,CAAC,CAACS,CAAS,CAACE,UAAX,CAAD,CAAwByC,MAAxB,CAA+BP,CAA/B,EAtBqC,GA2BjCQ,CAAAA,CAAS,CAAGrD,CAAC,CAAC,aAAD,CA3BoB,CA4BrCqD,CAAS,CAACT,IAAV,YACAS,CAAS,CAACP,IAAV,CAAe,IAAf,CAAoB,sBAApB,EACAO,CAAS,CAACN,GAAV,CAAc,CAAC,SAAa,UAAd,CAAd,EACAM,CAAS,CAACN,GAAV,CAAc,CAAC,MAAU,KAAX,CAAd,EACAM,CAAS,CAACN,GAAV,CAAc,CAAC,OAAW,MAAZ,CAAd,EACAM,CAAS,CAACN,GAAV,CAAc,CAAC,UAAY,MAAb,CAAd,EACAM,CAAS,CAACL,QAAV,CAAmB,iDAAnB,EAGA,GAAIM,CAAAA,CAAc,CAAGtD,CAAC,CAAC,mBAAD,CAAtB,CACAsD,CAAc,CAACJ,IAAf,CAAoB,SAApB,EACAI,CAAc,CAACN,QAAf,CAAwB,OAAxB,EACAM,CAAc,CAACH,IAAf,CAAoB,MAApB,CAA4B,QAA5B,EACAG,CAAc,CAACH,IAAf,CAAoB,cAApB,CAAoC,OAApC,EAGAE,CAAS,CAACD,MAAV,CAAiBE,CAAjB,EAIAC,UAAU,CAAC,UAAW,CAClBvD,CAAC,CAAC,uBAAD,CAAD,CAA2BwD,MAA3B,CAAkC,GAAlC,CAAuC,CAAvC,EAA0CC,OAA1C,CAAkD,GAAlD,CAAuD,UAAU,CAC7DzD,CAAC,CAAC,IAAD,CAAD,CAAQ0D,MAAR,GAEA1D,CAAC,CAACS,CAAS,CAACE,UAAX,CAAD,CAAwByC,MAAxB,CAA+BC,CAA/B,EAEAM,QAAQ,CAACC,MAAT,IACH,CAND,CAOH,CARS,CAQR,IARQ,CASb,CAvK2G,CAmL5G,MAAO,CACHC,IAAI,CANG,QAAPA,CAAAA,IAAO,CAAS/C,CAAT,CAAeC,CAAf,CAAyBC,CAAzB,CAAuC,CAC9CH,CAAW,CAACC,CAAD,CAAOC,CAAP,CAAiBC,CAAjB,CAAX,CACAC,CAAuB,EAC1B,CAEM,CAIV,CAxLK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Campus - Code for course header image uploader.\n *\n * @package    theme_urcourses_default\n * @author     John Lane\n *\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str',\n    'core/modal_factory', 'core/modal_events'], function($, ajax, notification, str, ModalFactory, ModalEvents) {\n\n    /** Container jquery object. */\n    var _root;\n    /** Course ID */\n    var _courseid;\n    var _availability;\n\n    /** Jquery selector strings. */\n    var SELECTORS = {\n        HEADER: '#page-header .header-body',\n        HEADER_TOP: \"#page-header .page-head\",\n        HDRMAKEAVAIL_BTN: '#avail_btn',\n    };\n\n    /**\n     * Initializes global variables.\n     * @param {string} root - Jquery selector for container.\n     * @param {int} availability - course visible\n     * @param {int} courseid - ID of current course.\n     * @return void\n     */\n    var _setGlobals = function(root, courseid, availability) {\n       _root = $(root);\n       _courseid = courseid;\n       _availability = availability;\n    };\n\n    /**\n     * Sets up event listeners.\n     * @return void\n     */\n    var _registerEventListeners = function() {\n        _root.on('click', SELECTORS.HDRMAKEAVAIL_BTN, _toggleAvailability);\n    };\n\n\n    /**\n     * Initiate ajax call to upload and set new image.\n     */\n    var _toggleAvailability = function() {\n\n        //if current style is clicked, do nothing...\n        /*\n        if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEA_BTN && _headerstyle == 0) {\n            return;\n        } else if ('#'+_element.attr('id') == SELECTORS.HDRSTYLEB_BTN && _headerstyle == 1) {\n            return;\n        }\n        */\n\n        //adding in confirmation modal in case buttons accidentally clicked\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: '<b>Make this course '+(_availability==1?'un':'')+'available?</b>',\n            body: \"<p>Are you sure you want to make this course <b>\"+(_availability==1?'un':'')\n            +\"available</b> to students?</b><br /><span class=\\\"small\\\">\"\n            +\"You can change the availability of this course as needed, when you're ready.</span></p>\"\n        })\n        .then(function(modal) {\n            modal.setSaveButtonText('Yes, make it '+(_availability==1?'un':'')\n            +'available');\n            var root = modal.getRoot();\n            root.on(ModalEvents.cancel, function(){\n                return;\n            });\n            root.on(ModalEvents.save, _availabilityChange);\n            modal.show();\n        });\n    };\n\n\n    var _availabilityChange = function() {\n\n        // return if required values aren't set\n        if (!_courseid) {\n            return;\n        }\n\n        // set args\n        var args = {\n            courseid: _courseid,\n            availability: _availability,\n        };\n\n        // set ajax call\n        var ajaxCall = {\n            methodname: 'theme_urcourses_default_toggle_course_availability',\n            args: args,\n            done: _choiceDone,\n            fail: notification.exception\n        };\n\n        // initiate ajax call\n        ajax.call([ajaxCall]);\n    };\n    /**\n     * Handles theme_urcourses_default_upload_course_image response data.\n     * @param {Object} response\n     */\n    var _choiceDone = function() {\n        str.get_string('success:courseavailabilitychanged', 'theme_urcourses_default')\n            .done(_createSuccessPopup);\n    };\n\n    /**\n     * Creates a bootstrap dismissable containing success text.\n     * Dismissable should appear in header and should cover upload button.\n     * @param {string} text Success text.\n     */\n    var _createSuccessPopup = function(text) {\n        // create bootstrap 4 dismissable\n        var popup = $('<div></div>');\n        popup.text(text);\n        popup.prop('id','cstyle_success_popup');\n        popup.css({'position' : 'absolute'});\n        popup.css({'right' : '5px'});\n        popup.css({'bottom' : '30px'});\n        popup.css({'z-index' : '1200'});\n        popup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var dismissBtn = $('<button></button>');\n        dismissBtn.html('&times;');\n        dismissBtn.addClass('close');\n        dismissBtn.attr('type', 'button');\n        dismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        popup.append(dismissBtn);\n\n        // add to header's course image area\n        $(SELECTORS.HEADER_TOP).append(popup);\n\n        var relotext = \"Loading\";\n\n        // create bootstrap 4 dismissable\n        var relopopup = $('<div></div>');\n        relopopup.text(relotext);\n        relopopup.prop('id','cstyle_success_popup');\n        relopopup.css({'position' : 'absolute'});\n        relopopup.css({'right' : '5px'});\n        relopopup.css({'bottom' : '30px'});\n        relopopup.css({'z-index' : '1200'});\n        relopopup.addClass('alert alert-success alert-dismissable fade show');\n\n        // create dismiss button\n        var relodismissBtn = $('<button></button>');\n        relodismissBtn.html('&times;');\n        relodismissBtn.addClass('close');\n        relodismissBtn.attr('type', 'button');\n        relodismissBtn.attr('data-dismiss', 'alert');\n\n        // append dismiss button to popup\n        relopopup.append(relodismissBtn);\n\n\n        // makes the alert disapear after a set amout of time.\n        setTimeout(function() {\n            $('#cstyle_success_popup').fadeTo(500, 0).slideUp(500, function(){\n                $(this).remove();\n                // add to header's course image area\n                $(SELECTORS.HEADER_TOP).append(relopopup);\n\n                location.reload(true);\n            });\n        },1800);\n    };\n\n    /**\n     * Entry point to module. Sets globals and registers event listeners.\n     * @param {String} root Jquery selector for container.\n     * @return void\n     */\n    var init = function(root, courseid, availability) {\n        _setGlobals(root, courseid, availability);\n        _registerEventListeners();\n    };\n\n    return {\n        init: init\n    };\n\n});"],"file":"toggle_course_availability.min.js"}