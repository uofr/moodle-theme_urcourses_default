function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("theme_urcourses_default/course_enrolment",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events","theme_urcourses_default/course_actions"],function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q={HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",BTN_COURSEENROL:"#btn_courseenrol",BTN_ENROLTERM:".btn_enrolterm",STARTHOLDER:"#course_tools_startholder",ENDHOLDER:"#course_tools_endholder",STARTDAY:"#course_tools_start_day",STARTMONTH:"#course_tools_start_month",STARTYEAR:"#course_tools_start_year",STARTHOUR:"#course_tools_start_hour",STARTMINUTE:"#course_tools_start_minute",ENDDAY:"#course_tools_end_day",ENDMONTH:"#course_tools_end_month",ENDYEAR:"#course_tools_end_year",ENDHOUR:"#course_tools_end_hour",ENDMINUTE:"#course_tools_end_minute",ENDENABLE:"#course_tools_enddate_enabled",ERR_START:"#error_course_tools_start",ERR_END:"#error_course_tools_end"},r={MODAL_COURSE_ACTION_CONTENT:"theme_urcourses_default/modal_course_action_date"},s=function(b,c,d,e,f,j,k){h=a(b);i=c;m=d;l=k;n=e;o=f;p=j;g=new g(i.id,i.coursename,i.shortname,i.startdate,i.enddate,o,n)},t=function(){h.on("click",q.BTN_ENROLTERM,x)},u=function(){a(".tmpl-label").bind("click",function(){v(a(this))})},v=function(a){if(a.hasClass("active")){a.removeClass("active");a.find(".fa-check-square-o").addClass("fa-square-o");a.find(".fa-square-o").removeClass("fa-check-square-o")}else{a.addClass("active");a.find(".fa-square-o").addClass("fa-check-square-o");a.find(".fa-check-square-o").removeClass("fa-square-o")}},w=function(){a("div[data-role=\"delete_button\"]").bind("click",function(){D(a(this))})},x=function(){j=a(this);k=j.attr("id");if(!i.id){return}var c={courseid:i.id,semester:k},d=b.call([{methodname:"theme_urcourses_default_header_enrollment_info",args:c}]);d[0].done(function(a){y(a)})},y=function(b){var c="Modify enrolment for "+b.semester,d="",g="",h=b.isavaliable;m="<div class=\"form-control-feedback invalid-feedback\" id=\"error_course_tools_section\"></div> <div data-role=\"templateholder\" class = \"list-group\" >";if(0!=b.courseinfo.length){a.each(b.courseinfo,function(a,b){m+="<div data-role = \"bannerselect\" class=\"tmpl-label  list-group-item list-group-item-action \" id = "+b.crn+"><h6><i class=\"fa fa-square-o\" aria-hidden=\"true\"></i>  "+b.subject+" "+b.course+"-"+b.section+" ("+b.crn+")</h6></div>"});m+="<br><div class=\"form-check ml-3\"><input class=\"form-check-input\" type=\"checkbox\" value=\"\" id=\"course_tools_groups\"><label class=\"form-check-label\" for=\"course_tools_groups\"><h6> Create groups for each section </h6> </label> </div>"}else{m+="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action\" id = \"0\" ><p>There are no additional sections available at this time </p></div>"}if(0!=b.activated.length){g="<label class=\"col-form-label d-inline\"><b> Current enrolments:  </b></label></br>";d+="<div class=\"list-group\">";a.each(b.activated,function(a,b){var c="alert-warning";if(b.linked){c="alert-success"}if(1!=b.linked){d+="<div data-role=\"delete_button\" data-fullname =\""+b.fullname+"\" id=\"delete_"+b.crn+"_"+b.urid+"\" class=\"list-group-item list-group-item-secondary enrollment-delete "+c+" \"><h6 class =\"ml-3 d-inline\">"+b.subject+" "+b.course+"-"+b.section+" ("+b.crn+")<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button></h6></div>"}else{d+="<div data-fullname =\""+b.fullname+"\" id=\"delete_"+b.crn+"_"+b.urid+"\" class=\"list-group-item list-group-item-secondary enrollment-delete "+c+" \"><h6 class =\"ml-3 d-inline\">"+b.subject+" "+b.course+"-"+b.section+" ("+b.crn+")</h6></div>"}});d+="</div><br>"}m+="</div>";var i=!1;if(k<l){i=!0}if(i){var c="Modify enrolment",m="<div data-role = \"templateselect\" class=\"tmpl-label list-group-item list-group-item-action\" id = \"0\" ><p>This is a past semester. Enrolment can not be modified. </p></div><br>";if(0!=b.activated.length){d="";d+="<div class=\"list-group\">";a.each(b.activated,function(a,b){var c="alert-warning";if(b.linked){c="alert-success"}d+="<div class=\"list-group-item list-group-item-secondary "+c+" \"><h6 class =\"ml-3 d-inline\">"+b.subject+" "+b.course+"-"+b.section+"</h6></div>"});d+="</div><br>"}e.create({type:e.types.CANCEL,title:c,body:m+g+d}).then(function(a){a.footer.prepend("<a type=\"button\" class=\"btn btn-primary justify-content-start mr-auto p-2\" href=\""+p+"/blocks/urcourserequest?semester="+k+"\">My enrolment overview</a>");a.show()})}else{e.create({type:0!=b.courseinfo.length?e.types.SAVE_CANCEL:e.types.CANCEL,title:c,body:h?"<label class=\"col-form-label d-inline\"><b> Available enrolments:  </b></label></br>"+m+"</br>"+g+d:""}).then(function(c){c.footer.prepend("<a type=\"button\" class=\"btn btn-primary justify-content-start mr-auto p-2\" href=\""+p+"/blocks/urcourserequest?semester="+k+"\">My enrolment overview</a>");if(h&&0!=b.courseinfo.length){c.setSaveButtonText("Save");var d=c.getRoot();d.on(f.cancel,function(){});d.on(f.save,function(c){var d=a("div[data-role=\"templateholder\""),e=a(d).find(".active");if(0>=e.length){c.preventDefault();a("#error_course_tools_section").text("Please select a section");a("#error_course_tools_section").attr("display","block");a("#error_course_tools_section").show()}else{for(var f=[],g=0;g<e.length;g++){f.push({crn:a(e[g]).attr("id")})}var h=a("#course_tools_groups").prop("checked");z(b,f,h)}})}else{var d=c.getRoot();d.on(f.cancel,function(){})}d.on(f.hidden,function(){a("div[data-role='templateholder']").remove()});c.show()}).done(function(){if(h){if(0<b.courseinfo.length){u(j)}else{a("button[data-action=\"cancel\"]").text("Close")}}if(0!=b.activated.length){w()}})}},z=function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(c,d,h){var l,n,o,p,s,t,u,v;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:l=new Date().getFullYear()+1;n=new Date().getMonth()+" "+new Date().getDate()+", "+new Date().getFullYear();o=new Date().getMonth()+" "+new Date().getDate()+", "+l;p="";a.each(m,function(a,b){if(a==k){var c=b.startdate.split("-"),e=b.enddate.split("-");n=parseInt(c[1],10)+" "+c[0]+", "+c[2];o=parseInt(e[1],10)+" "+e[0]+", "+e[2];var f=new Date(c[2],c[1]-1,c[0]);p=f.toLocaleString("default",{month:"short"})+" "+c[0]+", "+c[2]}});s=i.startdate.mon+" "+i.startdate.mday+", "+i.startdate.year;t=i.enddate.mon+" "+i.enddate.mday+", "+i.enddate.year;if(!(s==n&&t==o)){b.next=11;break}C(d,h,!0);b.next=18;break;case 11:u="Would you like to change course dates?";b.next=14;return self.render(r.MODAL_COURSE_ACTION_CONTENT);case 14:v=b.sent;s=i.startdate.month+" "+i.startdate.mday+", "+i.startdate.year;t=i.enddate.month+" "+i.enddate.mday+", "+i.enddate.year;e.create({type:e.types.SAVE_CANCEL,title:u,body:"<p><b>Current Course Dates:<br/></b><div class='alert alert-warning' role='alert'>"+(i.enddate.year<i.startdate.year?"Start Date: "+s+"<br> End Date: No endate set":s+" until "+t)+"</div>"+(""==p?"":"The "+c.semester+" term will begin "+p+"<br/><br/>")+v,backdrop:"static",keyboard:!1,dismissible:!1}).then(function(b){b.setSaveButtonText("Update");var c=b.getRoot();c.on(f.cancel,function(){C(d,h,!0)});c.on(f.save,function(a){if(!B()){a.preventDefault()}else{C(d,h,!1)}});b.show();var e=b.modal;a(e).find(".close").attr("id","closemodal");a("#closemodal").bind("click",function(){A(a(this),b)});a(e).find(".close").addClass("dateconfirm");a(c).click(function(c){if(!a(c.target).is("button")&&!a(c.target).parent().is("button")){c.preventDefault();b.show()}else{a(q.ENDHOLDER).remove();a(q.STARTHOLDER).remove();a(q.ERR_START).remove();a(q.ERR_END).remove();b.hide()}})}).done(function(){var b={year:new Date().getFullYear(),mon:new Date().getMonth(),mday:new Date().getDate()},c={year:new Date().getFullYear()+1,mon:new Date().getMonth(),mday:new Date().getDate()};a.each(m,function(a,d){if(a==k){var e=d.startdate.split("-"),f=d.enddate.split("-");b={year:e[2],mon:e[1],mday:e[0]};c={year:f[2],mon:f[1],mday:f[0]}}});a("button[data-action=\"cancel\"]").text("Continue without updating");g.populateDateSelects(b,c);g.registerDateEventListeners(j)});case 18:case"end":return b.stop();}}},b)}));return function(){return b.apply(this,arguments)}}(),A=function(b,c){a(q.ENDHOLDER).remove();a(q.STARTHOLDER).remove();a(q.ERR_START).remove();a(q.ERR_END).remove();c.hide()},B=function(){var b=a(q.STARTDAY).val(),c=a(q.STARTMONTH).val(),d=a(q.STARTYEAR).val(),e=a(q.ENDYEAR).val(),f=a(q.ENDDAY).val(),g=a(q.ENDMONTH).val(),h=!0,i=new Date(d+"."+c+"."+b).getTime()/1e3,j=new Date(e+"."+g+"."+f).getTime()/1e3;if(j<i&&a(q.ENDENABLE).is(":checked")){a(q.ERR_START).text("Course end date can not be before start date");a(q.ERR_START).attr("display","block");a(q.ERR_START).show();h=!1}else{a(q.ERR_START).text("");a(q.ERR_END).text("")}return h},C=function(d,g,h){if(!i.id){return}if(h){var j=i.startdate.mday+"-"+i.startdate.mon+"-"+i.startdate.year+"-"+i.startdate.hours+"-"+i.startdate.minutes,l=i.enddate.mday+"-"+i.enddate.mon+"-"+i.enddate.year+"-"+i.enddate.hours+"-"+i.enddate.minutes}else{var m=a(q.STARTDAY).val(),n=a(q.STARTMONTH).val(),o=a(q.STARTYEAR).val(),p=a(q.STARTHOUR).val(),r=a(q.STARTMINUTE).val(),j=m+"-"+n+"-"+o+"-"+p+"-"+r,l="0";if(a(q.ENDENABLE).is(":checked")){var s=a(q.ENDDAY).val(),t=a(q.ENDMONTH).val(),u=a(q.ENDYEAR).val(),v=a(q.ENDHOUR).val(),w=a(q.ENDMINUTE).val();l=s+"-"+t+"-"+u+"-"+v+"-"+w}}if(""==g||!1==g){g=0}else{g=1}var x={courseid:i.id,semester:k,crns:d,groupcheck:g,startdate:j,enddate:l,isoriginal:h},y={methodname:"theme_urcourses_default_header_activate_course",args:x,fail:c.exception},z=b.call([y]);z[0].done(function(b){var c="ERROR:",d="<div class=\"alert alert-warning\" role=\"alert\">"+b.result+"<br></div>";if(""!=b.value){c="Enrolment assigned successfully";d="<div class=\"alert alert-success\" role=\"alert\">"+b.result+"<br></div>"}e.create({type:e.types.CANCEL,title:c,body:d}).then(function(b){b.show();var c=b.getRoot();a("button[data-action=\"cancel\"]").text("Close");c.on(f.hidden,function(){location.reload()})})})},D=function(a){var b=a.data("fullname");e.create({type:e.types.SAVE_CANCEL,title:"Delete Enrolment",body:"<p><b>Are you sure you want to delete enrolment for "+b+"?</b><br />"}).then(function(b){b.setSaveButtonText("Delete");var c=b.getRoot();c.on(f.cancel,function(){});c.on(f.save,function(){E(a)});b.show()})},E=function(d){var g=d.attr("id").split("_"),h={courseid:g[2],semester:k,crn:g[1]},i={methodname:"theme_urcourses_default_header_delete_enrollment",args:h,fail:c.exception},j=b.call([i]);j[0].done(function(b){a("button[data-action=\"cancel\"] ").trigger("click");var c="ERROR:",d="<div class=\"alert alert-warning\" role=\"alert\">"+b.result+"<br></div>";if(""!=b.result){c="Successfully Removed Enrolment";d="<div class=\"alert alert-success\" role=\"alert\">"+b.result+"<br></div>"}e.create({type:e.types.CANCEL,title:c,body:d}).then(function(b){b.show();var c=b.getRoot();c.on(f.hidden,function(){location.reload()});a("button[data-action=\"cancel\"]").text("Close")})})},F=function(a){var b=a.split("-");return new Date(b[2]+"-"+b[1]+"-"+b[0])},G=function(b){var c=new Date,d="";a.each(b,function(a,b){var e=F(b.startdate),f=F(b.enddate);if(c>=e&&c<=f){d=a;return a}});return d};return{init:function init(a,b,c,d,e,f){var g=G(c);s(a,b,c,d,e,f,g);t()}}});
//# sourceMappingURL=course_enrolment.min.js.map
