{"version":3,"file":"toggle_course_visibility.min.js","sources":["../src/toggle_course_visibility.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Make it available\"/\"Make it unavailable\" button.\n * Allows user to toggle course visibility.\n *\n * @module  theme_urcourses_default/toggle_course_visibility\n * @author  2023 John Lane\n */\n\nimport $ from 'jquery';\nimport CustomEvents from 'core/custom_interaction_events';\nimport * as Repository from 'theme_urcourses_default/repository';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Notification from 'core/notification';\n\nconst SELECTORS = {\n    TOGGLE_VISIBILITY_BUTTON: '[data-action=\"toggle_course_visibility\"]'\n};\n\nlet _root = null;\nlet _confirmModal = null;\nlet _courseid = 0;\nlet _isCourseVisible = false;\nlet _strings = {};\n\nexport const init = (rootSelector, courseid, visible, strings) => {\n    _root = $(rootSelector);\n    _courseid = courseid;\n    _isCourseVisible = visible;\n    _strings = strings;\n\n    ModalFactory.create({type: ModalFactory.types.SAVE_CANCEL})\n    .then(modal => {\n        _confirmModal = modal;\n        _confirmModal.setSaveButtonText('Yes');\n        _confirmModal.getRoot().on(ModalEvents.save, toggleCourseVisibility);\n    });\n\n    registerEventListeners();\n};\n\nconst registerEventListeners = () => {\n    CustomEvents.define(_root, [\n        CustomEvents.events.activate\n    ]);\n\n    _root.on(CustomEvents.events.activate, SELECTORS.TOGGLE_VISIBILITY_BUTTON, (e, data) => {\n        showConfirmModal();\n        data.originalEvent.preventDefault();\n    });\n};\n\nconst showConfirmModal = () => {\n    const confirmTitle = _isCourseVisible ? _strings.setUnavailableTitle : _strings.setAvailableTitle;\n    const confirmBody = _isCourseVisible ? _strings.setUnavailableBody : _strings.setAvailableBody;\n\n    _confirmModal.setTitle(confirmTitle);\n    _confirmModal.setBody(confirmBody);\n    _confirmModal.show();\n};\n\nconst toggleCourseVisibility = async() => {\n    try {\n        await Repository.toggleCourseVisibility(_courseid);\n        location.reload();\n    } catch (error) {\n        Notification.exception(error);\n    }\n};"],"names":["SELECTORS","_root","_confirmModal","_courseid","_isCourseVisible","_strings","rootSelector","courseid","visible","strings","create","type","ModalFactory","types","SAVE_CANCEL","then","modal","setSaveButtonText","getRoot","on","ModalEvents","save","toggleCourseVisibility","registerEventListeners","define","CustomEvents","events","activate","e","data","showConfirmModal","originalEvent","preventDefault","confirmTitle","setUnavailableTitle","setAvailableTitle","confirmBody","setUnavailableBody","setAvailableBody","setTitle","setBody","show","async","Repository","location","reload","error","exception"],"mappings":"+qDA8BMA,mCACwB,+CAG1BC,MAAQ,KACRC,cAAgB,KAChBC,UAAY,EACZC,kBAAmB,EACnBC,SAAW,iBAEK,CAACC,aAAcC,SAAUC,QAASC,WAClDR,OAAQ,mBAAEK,cACVH,UAAYI,SACZH,iBAAmBI,QACnBH,SAAWI,+BAEEC,OAAO,CAACC,KAAMC,uBAAaC,MAAMC,cAC7CC,MAAKC,QACFd,cAAgBc,MAChBd,cAAce,kBAAkB,OAChCf,cAAcgB,UAAUC,GAAGC,sBAAYC,KAAMC,2BAGjDC,gCAGEA,uBAAyB,wCACdC,OAAOvB,MAAO,CACvBwB,mCAAaC,OAAOC,WAGxB1B,MAAMkB,GAAGM,mCAAaC,OAAOC,SAAU3B,oCAAoC,CAAC4B,EAAGC,QAC3EC,mBACAD,KAAKE,cAAcC,qBAIrBF,iBAAmB,WACfG,aAAe7B,iBAAmBC,SAAS6B,oBAAsB7B,SAAS8B,kBAC1EC,YAAchC,iBAAmBC,SAASgC,mBAAqBhC,SAASiC,iBAE9EpC,cAAcqC,SAASN,cACvB/B,cAAcsC,QAAQJ,aACtBlC,cAAcuC,QAGZnB,uBAAyBoB,oBAEjBC,WAAWrB,uBAAuBnB,WACxCyC,SAASC,SACX,MAAOC,6BACQC,UAAUD"}