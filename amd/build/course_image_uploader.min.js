define("theme_urcourses_default/course_image_uploader",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,ajax,notification,str,ModalFactory,ModalEvents){var _root,_maxbytes,_courseid,_imagedata,_imagename,SELECTORS_UPLOADER="#course_image_uploader",SELECTORS_HEADER="#page-header .header-body",SELECTORS_HEADER_TOP="#page-header .page-head",SELECTORS_SQUARE_IMG="#hdr_chooser_a_div",SELECTORS_STYLE_HDR="#header_a_head",SELECTORS_UPLOAD_BTN="#upload_img_confirm",SELECTORS_CANCEL_BTN="#upload_img_cancel",_setImageData=function(imagedata){_imagedata=imagedata},_setImageName=function(imagename){_imagename=imagename},_handleImageChange=function(event){if(event.target.files.length){var file=event.target.files[0];if(file.type.match("image.*"))if(file.size>_maxbytes)str.get_string("error:courseimageexceedsmaxbytes","theme_urcourses_default",_humanFileSize(_maxbytes)).done(_createErrorPopup);else{_setImageName(file.name);var reader=new FileReader;reader.onload=_confirmImageUpload,reader.readAsDataURL(file)}else str.get_string("error:courseimageinvalidfiletype","theme_urcourses_default").done(_createErrorPopup)}},_confirmImageUpload=function(file){var imagedata=file.target.result,styleselect=$(SELECTORS_STYLE_HDR).length>0?SELECTORS_SQUARE_IMG:SELECTORS_HEADER;$(styleselect).data("original_img",$(styleselect).css("background-image")),$(SELECTORS_SQUARE_IMG).css({"background-image":"url("+imagedata+")"}),$(SELECTORS_HEADER).css({"background-image":"url("+imagedata+")"}),_root.addClass("confirm"),imagedata=imagedata.split("base64,")[1],_setImageData(imagedata)},_uploadImage=function(){if(_imagedata&&_imagename&&_courseid){var ajaxCall={methodname:"theme_urcourses_default_upload_course_image",args:{courseid:_courseid,imagedata:_imagedata,imagename:_imagename},done:_uploadDone,fail:notification.exception};ajax.call([ajaxCall])}},_uploadDone=function(){_setImageData(""),_setImageName(""),_root.removeClass("confirm"),$(SELECTORS_HEADER).data("original_image",""),$(SELECTORS_UPLOADER).val(""),str.get_string("success:courseimageuploaded","theme_urcourses_default").done(_createSuccessPopup)},_cancelUpload=function(){_setImageData(""),_setImageName("");var original_img=$(SELECTORS_HEADER).data("original_img");$(SELECTORS_SQUARE_IMG).css({"background-image":original_img}),$(SELECTORS_HEADER).css({"background-image":original_img}),$(SELECTORS_UPLOADER).val(""),_root.removeClass("confirm"),$(SELECTORS_HEADER).data("original_image","")},_createErrorPopup=function(text){var popup=$("<div></div>");popup.text(text),popup.css({position:"absolute"}),popup.css({left:"5px"}),popup.css({bottom:"30px"}),popup.addClass("alert alert-danger alert-dismissable fade show");var dismissBtn=$("<button></button>");dismissBtn.html("&times;"),dismissBtn.addClass("close"),dismissBtn.attr("type","button"),dismissBtn.attr("data-dismiss","alert"),popup.append(dismissBtn),$(SELECTORS_HEADER_TOP).append(popup)},_createSuccessPopup=function(text){var popup=$("<div></div>");popup.text(text),popup.prop("id","cimage_success_popup"),popup.css({position:"absolute"}),popup.css({left:"5px"}),popup.css({bottom:"30px"}),popup.addClass("alert alert-success alert-dismissable fade show");var dismissBtn=$("<button></button>");dismissBtn.html("&times;"),dismissBtn.addClass("close"),dismissBtn.attr("type","button"),dismissBtn.attr("data-dismiss","alert"),popup.append(dismissBtn),$(SELECTORS_HEADER_TOP).append(popup),setTimeout((function(){$("#cimage_success_popup").fadeTo(500,0).slideUp(500,(function(){$(this).remove()}))}),1800)},_humanFileSize=function(size){var i=Math.floor(Math.log(size)/Math.log(1024));return 1*(size/Math.pow(1024,i)).toFixed(2)+" "+["B","KB","MB","GB","TB"][i]};return{init:function(root,maxbytes,courseid){!function(root,maxbytes,courseid){_root=$(root),_maxbytes=maxbytes,_courseid=courseid}(root,maxbytes,courseid),_root.on("change",SELECTORS_UPLOADER,_handleImageChange),_root.on("click",SELECTORS_UPLOAD_BTN,_uploadImage),_root.on("click",SELECTORS_CANCEL_BTN,_cancelUpload)}}}));

//# sourceMappingURL=course_image_uploader.min.js.map