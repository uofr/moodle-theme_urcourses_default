define("theme_urcourses_default/course_actions",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/templates","core/form-autocomplete"],(function(_exports,_jquery,_ajax,_modal_factory,_modal_events,_notification,_templates,_formAutocomplete){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_formAutocomplete=_interopRequireDefault(_formAutocomplete);var TEMPLATES_MODAL_COURSE_ACTION_CONTENT="theme_urcourses_default/modal_course_action_content",SELECTORS_COURSENAME="#course_tools_coursename",SELECTORS_SHORTNAME="#course_tools_shortname",SELECTORS_CATEGORY="#course_tools_category",SELECTORS_MODALHOLDER="#course_tools_modal_content",SELECTORS_STARTDAY="#course_tools_start_day",SELECTORS_STARTMONTH="#course_tools_start_month",SELECTORS_STARTYEAR="#course_tools_start_year",SELECTORS_STARTHOUR="#course_tools_start_hour",SELECTORS_STARTMINUTE="#course_tools_start_minute",SELECTORS_ENDDAY="#course_tools_end_day",SELECTORS_ENDMONTH="#course_tools_end_month",SELECTORS_ENDYEAR="#course_tools_end_year",SELECTORS_ENDHOUR="#course_tools_end_hour",SELECTORS_ENDMINUTE="#course_tools_end_minute",SELECTORS_ENDENABLE="#course_tools_enddate_enabled",SELECTORS_ERR_COURSENAME="#error_course_tools_coursename",SELECTORS_ERR_SHORTNAME="#error_course_tools_shortname",SELECTORS_ERR_CATEGORY="#error_course_tools_category",SELECTORS_ERR_START="#error_course_tools_start",SELECTORS_ERR_END="#error_course_tools_end",courseActionsLib=function(){function courseActionsLib(courseid,coursename,shortname,startdate,enddate,templatelist,categories){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,courseActionsLib),self=this,self._courseid=courseid,self._coursename=coursename,self._shortname=shortname,self._startdate=startdate,self._enddate=enddate,self._templatelist=templatelist,self._categories=categories}var Constructor,protoProps,staticProps,_render,_coursereqAction;return Constructor=courseActionsLib,protoProps=[{key:"coursereqAction",value:(_coursereqAction=_asyncToGenerator(regeneratorRuntime.mark((function _callee(_element,button,selectcatergory,selectstart,selectend){var modaltitle,modalaction,templatenew,istemplatelist,template;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return modaltitle=_element.attr("id")==button?"Create new course":"Duplicate this course",modalaction=_element.attr("id")==button?"create a new":"duplicate this",templatenew=_element.attr("id")==button||"",istemplatelist=self._templatelist.length>0||"",_context.next=6,self.render(TEMPLATES_MODAL_COURSE_ACTION_CONTENT,templatenew,istemplatelist);case 6:template=_context.sent,_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:modaltitle,body:"<p><b>Are you sure you want to "+modalaction+" course?</b><br />"+(_element.attr("id")==button?"<small>Select from the templates below. (Scroll for more options)</small>":"<small>Student data will not be included in the duplicated course.</small>")+template+"</p>"}).then((function(modal){modal.setSaveButtonText(_element.attr("id")==button?"Create new course":"Duplicate this course");var root=modal.getRoot();root.on(_modal_events.default.cancel,(function(){})),root.on(_modal_events.default.save,(function(e){if(e.preventDefault(),self.validate())return _element.attr("id")==button?void self.createCourse():void self.duplicateCourse()})),root.on(_modal_events.default.hidden,(function(){(0,_jquery.default)(SELECTORS_MODALHOLDER).remove()})),modal.show()})).done((function(){if(_element.attr("id")==button?self.registerSelectorEventListeners(_element,button):((0,_jquery.default)(SELECTORS_COURSENAME).val(self._coursename+" (Copy)"),(0,_jquery.default)(SELECTORS_SHORTNAME).val(self._shortname+" (Copy)")),_element.attr("id")==button){var d=new Date;selectstart.year=d.getFullYear(),selectstart.mon=d.getMonth()+1,selectstart.mday=d.getDate(),selectend.year=d.getFullYear()+1,selectend.mon=d.getMonth()+1,selectend.mday=d.getDate()}self.populateDateSelects(selectstart,selectend),_formAutocomplete.default.enhance("#course_tools_category",[],"","Search",!1,!0,"No Selection"),(0,_jquery.default)(SELECTORS_CATEGORY).val(selectcatergory),self.registerDateEventListeners(_element)}));case 8:case"end":return _context.stop()}}),_callee)}))),function(_x,_x2,_x3,_x4,_x5){return _coursereqAction.apply(this,arguments)})},{key:"populateDateSelects",value:function(selectstart,selectend){for(var currentyear=(new Date).getFullYear(),year=1900;year<currentyear+30;year++)(0,_jquery.default)(SELECTORS_STARTYEAR).append('<option  value="'+year+'" '+(year==selectstart.year?"selected":" ")+">"+year+"</option>"),(0,_jquery.default)(SELECTORS_ENDYEAR).append('<option value="'+year+'"'+(year==selectend.year&&selectend.year>=selectstart.year||year==currentyear&&selectend.year<selectstart.year?"selected":" ")+">"+year+"</option>");for(var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],currentmonth=(new Date).getMonth(),month=0;month<monthNames.length;month++){var mtemp=month;mtemp++,(0,_jquery.default)(SELECTORS_STARTMONTH).append('<option value="'+mtemp+'" '+(mtemp==selectstart.mon?"selected":" ")+">"+monthNames[month]+"</option>"),(0,_jquery.default)(SELECTORS_ENDMONTH).append('<option value="'+mtemp+'" '+(mtemp==selectend.mon&&selectend.year>=selectstart.year||month==currentmonth&&selectend.year<selectstart.year?"selected":" ")+">"+monthNames[month]+"</option>")}for(var currentday=(new Date).getDate(),day=1;day<32;day++)(0,_jquery.default)(SELECTORS_STARTDAY).append('<option value="'+day+'" '+(day==selectstart.mday?"selected":" ")+">"+day+"</option>"),(0,_jquery.default)(SELECTORS_ENDDAY).append('<option value="'+day+'" '+(day==selectend.mday&&selectend.year>=selectstart.year||day==currentday&&selectend.year<selectstart.year?"selected":" ")+">"+day+"</option>");for(var hour=0;hour<24;hour++)(0,_jquery.default)(SELECTORS_STARTHOUR).append('<option value="'+hour+'">'+(hour<10?"0"+hour:hour)+"</option>"),(0,_jquery.default)(SELECTORS_ENDHOUR).append('<option value="'+hour+'">'+(hour<10?"0"+hour:hour)+"</option>");for(var minute=0;minute<61;minute++)(0,_jquery.default)(SELECTORS_STARTMINUTE).append('<option value="'+minute+'"    >'+(minute<10?"0"+minute:minute)+"</option>"),(0,_jquery.default)(SELECTORS_ENDMINUTE).append('<option  value="'+minute+'"  >'+(minute<10?"0"+minute:minute)+"</option>")}},{key:"setActiveTemplate",value:function(e){var templateHolder=(0,_jquery.default)('div[data-role="templateholder"');(0,_jquery.default)(templateHolder).find(".active").removeClass("active"),e.addClass("active")}},{key:"setEnddate",value:function(e){var checked;checked=!e.is(":checked"),(0,_jquery.default)(SELECTORS_ENDDAY).prop("disabled",checked),(0,_jquery.default)(SELECTORS_ENDMONTH).prop("disabled",checked),(0,_jquery.default)(SELECTORS_ENDYEAR).prop("disabled",checked),(0,_jquery.default)(SELECTORS_ENDHOUR).prop("disabled",checked),(0,_jquery.default)(SELECTORS_ENDMINUTE).prop("disabled",checked)}},{key:"validateDaysInMonth",value:function(){var startyear=(0,_jquery.default)(SELECTORS_STARTYEAR).val(),endyear=(0,_jquery.default)(SELECTORS_ENDYEAR).val(),startmonth=(0,_jquery.default)(SELECTORS_STARTMONTH).val(),endmonth=(0,_jquery.default)(SELECTORS_ENDMONTH).val(),startday=(0,_jquery.default)(SELECTORS_STARTDAY).val(),endday=(0,_jquery.default)(SELECTORS_ENDDAY).val(),actualStart=new Date(startyear,startmonth,0).getDate(),actualEnd=new Date(endyear,endmonth,0).getDate();actualStart<startday&&(0,_jquery.default)(SELECTORS_STARTDAY).val(actualStart),actualEnd<endday&&(0,_jquery.default)(SELECTORS_ENDDAY).val(actualEnd)}},{key:"render",value:(_render=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(template,templatenew,istemplatelist){var templatelist,categories,renderData,renderPromise;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return templatelist=[],_jquery.default.each(self._templatelist,(function(key,val){templatelist.push({id:val.id,fullname:val.fullname,summary:val.summary,courseimage:val.courseimage})})),categories=[],_jquery.default.each(self._categories,(function(key,val){categories.push({id:val.id,name:val.name})})),renderData={templatenew:templatenew,templatelist:templatelist,istemplatelist:istemplatelist,categories:categories},_context2.next=7,_templates.default.render(template,renderData);case 7:return renderPromise=_context2.sent,_context2.abrupt("return",renderPromise);case 9:case"end":return _context2.stop()}}),_callee2)}))),function(_x6,_x7,_x8){return _render.apply(this,arguments)})},{key:"registerSelectorEventListeners",value:function(_element,button){_element.attr("id")==button&&((0,_jquery.default)(".tmpl-label").bind("click",(function(){self.setActiveTemplate((0,_jquery.default)(this))})),(0,_jquery.default)('button[data-role="info_button"').bind("click",(function(){self.showMoreInfo((0,_jquery.default)(this))})))}},{key:"registerDateEventListeners",value:function(){(0,_jquery.default)(SELECTORS_ENDENABLE).bind("click",(function(){self.setEnddate((0,_jquery.default)(this))})),(0,_jquery.default)(SELECTORS_ENDMONTH).bind("blur",(function(){self.validateDaysInMonth((0,_jquery.default)(this))})),(0,_jquery.default)(SELECTORS_ENDDAY).bind("blur",(function(){self.validateDaysInMonth((0,_jquery.default)(this))})),(0,_jquery.default)(SELECTORS_STARTMONTH).bind("blur",(function(){self.validateDaysInMonth((0,_jquery.default)(this))})),(0,_jquery.default)(SELECTORS_STARTDAY).bind("blur",(function(){self.validateDaysInMonth((0,_jquery.default)(this))}))}},{key:"validate",value:function(){var coursename=(0,_jquery.default)(SELECTORS_COURSENAME).val(),shortname=(0,_jquery.default)(SELECTORS_SHORTNAME).val(),startday=(0,_jquery.default)(SELECTORS_STARTDAY).val(),startmonth=(0,_jquery.default)(SELECTORS_STARTMONTH).val(),startyear=(0,_jquery.default)(SELECTORS_STARTYEAR).val(),endyear=(0,_jquery.default)(SELECTORS_ENDYEAR).val(),endday=(0,_jquery.default)(SELECTORS_ENDDAY).val(),endmonth=(0,_jquery.default)(SELECTORS_ENDMONTH).val(),category=(0,_jquery.default)(SELECTORS_CATEGORY).val(),test=!0;0==coursename.length?((0,_jquery.default)(SELECTORS_ERR_COURSENAME).text("Please enter a name for the course"),(0,_jquery.default)(SELECTORS_ERR_COURSENAME).attr("display","block"),(0,_jquery.default)(SELECTORS_ERR_COURSENAME).show(),test=!1):(0,_jquery.default)(SELECTORS_ERR_COURSENAME).text(""),0==shortname.length?((0,_jquery.default)(SELECTORS_ERR_SHORTNAME).text("Please enter a short name for the course"),(0,_jquery.default)(SELECTORS_ERR_SHORTNAME).attr("display","block"),(0,_jquery.default)(SELECTORS_ERR_SHORTNAME).show(),test=!1):(0,_jquery.default)(SELECTORS_ERR_SHORTNAME).text(""),0==category||""==category?((0,_jquery.default)(SELECTORS_ERR_CATEGORY).text("Please select a category"),(0,_jquery.default)(SELECTORS_ERR_CATEGORY).attr("display","block"),(0,_jquery.default)(SELECTORS_ERR_CATEGORY).show(),test=!1):(0,_jquery.default)(SELECTORS_ERR_CATEGORY).text("");var startdate=new Date(startyear+"."+startmonth+"."+startday).getTime()/1e3;return new Date(endyear+"."+endmonth+"."+endday).getTime()/1e3<startdate&&(0,_jquery.default)(SELECTORS_ENDENABLE).is(":checked")?((0,_jquery.default)(SELECTORS_ERR_START).text("Course end date can not be before start date"),(0,_jquery.default)(SELECTORS_ERR_START).attr("display","block"),(0,_jquery.default)(SELECTORS_ERR_START).show(),test=!1):((0,_jquery.default)(SELECTORS_ERR_START).text(""),(0,_jquery.default)(SELECTORS_ERR_END).text("")),test}},{key:"showMoreInfo",value:function(e){var course="";_jquery.default.each(self._templatelist,(function(key,val){e.attr("id").split("_")[1]==val.id&&(course={id:val.id,fullname:val.fullname,summary:val.summary,courseimage:val.courseimage})})),_modal_factory.default.create({type:_modal_factory.default.types.DEFAULT,title:course.fullname,body:course.summary}).then((function(modal){modal.show()}))}},{key:"createCourse",value:function(){if(self._courseid){var templateHolder=(0,_jquery.default)('div[data-role="templateholder"'),selectedTemplate=(0,_jquery.default)(templateHolder).find(".active"),templateid=(0,_jquery.default)(selectedTemplate).attr("id"),coursename=(0,_jquery.default)(SELECTORS_COURSENAME).val(),shortname=(0,_jquery.default)(SELECTORS_SHORTNAME).val(),category=(0,_jquery.default)(SELECTORS_CATEGORY).val(),startdate=(0,_jquery.default)(SELECTORS_STARTDAY).val()+"-"+(0,_jquery.default)(SELECTORS_STARTMONTH).val()+"-"+(0,_jquery.default)(SELECTORS_STARTYEAR).val()+"-"+(0,_jquery.default)(SELECTORS_STARTHOUR).val()+"-"+(0,_jquery.default)(SELECTORS_STARTMINUTE).val(),enddate="0";(0,_jquery.default)(SELECTORS_ENDENABLE).is(":checked")&&(enddate=(0,_jquery.default)(SELECTORS_ENDDAY).val()+"-"+(0,_jquery.default)(SELECTORS_ENDMONTH).val()+"-"+(0,_jquery.default)(SELECTORS_ENDYEAR).val()+"-"+(0,_jquery.default)(SELECTORS_ENDHOUR).val()+"-"+(0,_jquery.default)(SELECTORS_ENDMINUTE).val()),self.spinnerCheck("show");var ajaxCall={methodname:"theme_urcourses_default_header_create_course",args:{courseid:self._courseid,templateid:templateid,coursename:coursename,shortname:shortname,categoryid:category,startdate:startdate,enddate:enddate},fail:_notification.default.exception};_ajax.default.call([ajaxCall])[0].done((function(response){if(self.spinnerCheck("hide"),""!=response.error){var info=response.error;_modal_factory.default.create({title:"ERROR:",body:"<p><b>"+info+"</b><br></p>"}).done((function(modal){modal.show()}))}""!=response.url&&(window.location.href=response.url)})).fail((function(){self.spinnerCheck("hide")}))}}},{key:"duplicateCourse",value:function(){if(self._courseid){var coursename=(0,_jquery.default)(SELECTORS_COURSENAME).val(),shortname=(0,_jquery.default)(SELECTORS_SHORTNAME).val(),category=(0,_jquery.default)(SELECTORS_CATEGORY).val(),startdate=(0,_jquery.default)(SELECTORS_STARTDAY).val()+"-"+(0,_jquery.default)(SELECTORS_STARTMONTH).val()+"-"+(0,_jquery.default)(SELECTORS_STARTYEAR).val()+"-"+(0,_jquery.default)(SELECTORS_STARTHOUR).val()+"-"+(0,_jquery.default)(SELECTORS_STARTMINUTE).val(),enddate="0";(0,_jquery.default)(SELECTORS_ENDENABLE).is(":checked")&&(enddate=(0,_jquery.default)(SELECTORS_ENDDAY).val()+"-"+(0,_jquery.default)(SELECTORS_ENDMONTH).val()+"-"+(0,_jquery.default)(SELECTORS_ENDYEAR).val()+"-"+(0,_jquery.default)(SELECTORS_ENDHOUR).val()+"-"+(0,_jquery.default)(SELECTORS_ENDMINUTE).val()),self.spinnerCheck("show");var ajaxCall={methodname:"theme_urcourses_default_header_duplicate_course",args:{courseid:self._courseid,coursename:coursename,shortname:shortname,categoryid:category,startdate:startdate,enddate:enddate},fail:_notification.default.exception};_ajax.default.call([ajaxCall])[0].done((function(response){if(self.spinnerCheck("hide"),""!=response.error){if(""==response.user)var info="<p><b>"+response.error+"</b><br></p>";else info='<div class="alert alert-warning" role="alert">'+response.error+"<b>"+response.user+".</b></div>";_modal_factory.default.create({title:"Notice:",body:info}).done((function(modal){modal.show()}))}""!=response.url&&(window.location.href=response.url)})).fail((function(){self.spinnerCheck("hide")}))}}},{key:"spinnerCheck",value:function(type){(0,_jquery.default)("#mainspinner").length&&("hide"==type?((0,_jquery.default)("#mainspinner").hide(),(0,_jquery.default)("#infoholder").removeClass("block_urcourserequest_overlay")):((0,_jquery.default)("#mainspinner").show(),(0,_jquery.default)("#infoholder").addClass("block_urcourserequest_overlay")))}}],protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),courseActionsLib}();return _exports.default=courseActionsLib,_exports.default}));

//# sourceMappingURL=course_actions.min.js.map