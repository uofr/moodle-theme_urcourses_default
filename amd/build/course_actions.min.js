define ("theme_urcourses_default/course_actions",["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/templates","core/form-autocomplete"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=i(b);c=i(c);d=i(d);e=i(e);f=i(f);g=i(g);h=i(h);function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function k(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){j(h,d,e,f,g,"next",a)}function g(a){j(h,d,e,f,g,"throw",a)}f(void 0)})}}function l(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function m(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function n(a,b,c){if(b)m(a.prototype,b);if(c)m(a,c);return a}var o={MODAL_COURSE_ACTION_CONTENT:"theme_urcourses_default/modal_course_action_content"},p={COURSENAME:"#course_tools_coursename",SHORTNAME:"#course_tools_shortname",CATEGORY:"#course_tools_category",MODALHOLDER:"#course_tools_modal_content",STARTDAY:"#course_tools_start_day",STARTMONTH:"#course_tools_start_month",STARTYEAR:"#course_tools_start_year",STARTHOUR:"#course_tools_start_hour",STARTMINUTE:"#course_tools_start_minute",ENDDAY:"#course_tools_end_day",ENDMONTH:"#course_tools_end_month",ENDYEAR:"#course_tools_end_year",ENDHOUR:"#course_tools_end_hour",ENDMINUTE:"#course_tools_end_minute",ENDENABLE:"#course_tools_enddate_enabled",ERR_COURSENAME:"#error_course_tools_coursename",ERR_SHORTNAME:"#error_course_tools_shortname",ERR_CATEGORY:"#error_course_tools_category",ERR_START:"#error_course_tools_start",ERR_END:"#error_course_tools_end"},q=function(){function a(b,c,d,e,f,g,h){l(this,a);self=this;self._courseid=b;self._coursename=c;self._shortname=d;self._startdate=e;self._enddate=f;self._templatelist=g;self._categories=h}n(a,[{key:"coursereqAction",value:function(){var a=k(regeneratorRuntime.mark(function a(c,f,g,i,j){var k,l,m,n,q;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:k=c.attr("id")==f?"Create new course":"Duplicate this course";l=c.attr("id")==f?"create a new":"duplicate this";m=c.attr("id")==f?!0:"";n=0<self._templatelist.length?!0:"";a.next=6;return self.render(o.MODAL_COURSE_ACTION_CONTENT,m,n);case 6:q=a.sent;d.default.create({type:d.default.types.SAVE_CANCEL,title:k,body:"<p><b>Are you sure you want to "+l+" course?</b><br />"+(c.attr("id")==f?"<small>Select from the templates below. (Scroll for more options)</small>":"<small>Student data will not be included in the duplicated course.</small>")+q+"</p>"}).then(function(a){a.setSaveButtonText(c.attr("id")==f?"Create new course":"Duplicate this course");var d=a.getRoot();d.on(e.default.cancel,function(){return});d.on(e.default.save,function(a){a.preventDefault();if(self.validate()){if(c.attr("id")==f){self.createCourse();return}else{self.duplicateCourse();return}}});d.on(e.default.hidden,function(){(0,b.default)(p.MODALHOLDER).remove()});a.show()}).done(function(){if(c.attr("id")==f){self.registerSelectorEventListeners(c,f)}else{(0,b.default)(p.COURSENAME).val(self._coursename+" (Copy)");(0,b.default)(p.SHORTNAME).val(self._shortname+" (Copy)")}if(c.attr("id")==f){var a=new Date;i.year=a.getFullYear();i.mon=a.getMonth()+1;i.mday=a.getDate();j.year=a.getFullYear()+1;j.mon=a.getMonth()+1;j.mday=a.getDate()}self.populateDateSelects(i,j);h.default.enhance("#course_tools_category",[],"","Search",!1,!0,"No Selection");(0,b.default)(p.CATEGORY).val(g);self.registerDateEventListeners(c)});case 8:case"end":return a.stop();}}},a)}));return function coursereqAction(){return a.apply(this,arguments)}}()},{key:"populateDateSelects",value:function populateDateSelects(a,c){for(var d=new Date().getFullYear(),e=1900;e<d+30;e++){(0,b.default)(p.STARTYEAR).append("<option  value=\""+e+"\" "+(e==a.year?"selected":" ")+">"+e+"</option>");(0,b.default)(p.ENDYEAR).append("<option value=\""+e+"\""+(e==c.year&&c.year>=a.year||e==d&&c.year<a.year?"selected":" ")+">"+e+"</option>")}for(var f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=new Date().getMonth(),h=0,i;h<f.length;h++){i=h;i++;(0,b.default)(p.STARTMONTH).append("<option value=\""+i+"\" "+(i==a.mon?"selected":" ")+">"+f[h]+"</option>");(0,b.default)(p.ENDMONTH).append("<option value=\""+i+"\" "+(i==c.mon&&c.year>=a.year||h==g&&c.year<a.year?"selected":" ")+">"+f[h]+"</option>")}for(var j=new Date().getDate(),k=1;32>k;k++){(0,b.default)(p.STARTDAY).append("<option value=\""+k+"\" "+(k==a.mday?"selected":" ")+">"+k+"</option>");(0,b.default)(p.ENDDAY).append("<option value=\""+k+"\" "+(k==c.mday&&c.year>=a.year||k==j&&c.year<a.year?"selected":" ")+">"+k+"</option>")}for(var l=0;24>l;l++){(0,b.default)(p.STARTHOUR).append("<option value=\""+l+"\">"+(10>l?"0"+l:l)+"</option>");(0,b.default)(p.ENDHOUR).append("<option value=\""+l+"\">"+(10>l?"0"+l:l)+"</option>")}for(var m=0;61>m;m++){(0,b.default)(p.STARTMINUTE).append("<option value=\""+m+"\"    >"+(10>m?"0"+m:m)+"</option>");(0,b.default)(p.ENDMINUTE).append("<option  value=\""+m+"\"  >"+(10>m?"0"+m:m)+"</option>")}}},{key:"setActiveTemplate",value:function setActiveTemplate(a){var c=(0,b.default)("div[data-role=\"templateholder\"");(0,b.default)(c).find(".active").removeClass("active");a.addClass("active")}},{key:"setEnddate",value:function setEnddate(a){var c;if(a.is(":checked")){c=!1}else{c=!0}(0,b.default)(p.ENDDAY).prop("disabled",c);(0,b.default)(p.ENDMONTH).prop("disabled",c);(0,b.default)(p.ENDYEAR).prop("disabled",c);(0,b.default)(p.ENDHOUR).prop("disabled",c);(0,b.default)(p.ENDMINUTE).prop("disabled",c)}},{key:"validateDaysInMonth",value:function validateDaysInMonth(){var a=(0,b.default)(p.STARTYEAR).val(),c=(0,b.default)(p.ENDYEAR).val(),d=(0,b.default)(p.STARTMONTH).val(),e=(0,b.default)(p.ENDMONTH).val(),f=(0,b.default)(p.STARTDAY).val(),g=(0,b.default)(p.ENDDAY).val(),h=new Date(a,d,0).getDate(),i=new Date(c,e,0).getDate();if(h<f){(0,b.default)(p.STARTDAY).val(h)}if(i<g){(0,b.default)(p.ENDDAY).val(i)}}},{key:"render",value:function(){var a=k(regeneratorRuntime.mark(function a(c,d,e){var f,h,i,j;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=[];b.default.each(self._templatelist,function(a,b){f.push({id:b.id,fullname:b.fullname,summary:b.summary,courseimage:b.courseimage})});h=[];b.default.each(self._categories,function(a,b){h.push({id:b.id,name:b.name})});i={templatenew:d,templatelist:f,istemplatelist:e,categories:h};a.next=7;return g.default.render(c,i);case 7:j=a.sent;return a.abrupt("return",j);case 9:case"end":return a.stop();}}},a)}));return function render(){return a.apply(this,arguments)}}()},{key:"registerSelectorEventListeners",value:function registerSelectorEventListeners(a,c){if(a.attr("id")==c){(0,b.default)(".tmpl-label").bind("click",function(){self.setActiveTemplate((0,b.default)(this))});(0,b.default)("button[data-role=\"info_button\"").bind("click",function(){self.showMoreInfo((0,b.default)(this))})}}},{key:"registerDateEventListeners",value:function registerDateEventListeners(){(0,b.default)(p.ENDENABLE).bind("click",function(){self.setEnddate((0,b.default)(this))});(0,b.default)(p.ENDMONTH).bind("blur",function(){self.validateDaysInMonth((0,b.default)(this))});(0,b.default)(p.ENDDAY).bind("blur",function(){self.validateDaysInMonth((0,b.default)(this))});(0,b.default)(p.STARTMONTH).bind("blur",function(){self.validateDaysInMonth((0,b.default)(this))});(0,b.default)(p.STARTDAY).bind("blur",function(){self.validateDaysInMonth((0,b.default)(this))})}},{key:"validate",value:function validate(){var a=(0,b.default)(p.COURSENAME).val(),c=(0,b.default)(p.SHORTNAME).val(),d=(0,b.default)(p.STARTDAY).val(),e=(0,b.default)(p.STARTMONTH).val(),f=(0,b.default)(p.STARTYEAR).val(),g=(0,b.default)(p.ENDYEAR).val(),h=(0,b.default)(p.ENDDAY).val(),i=(0,b.default)(p.ENDMONTH).val(),j=!0;if(0==a.length){(0,b.default)(p.ERR_COURSENAME).text("Please enter a name for the course");(0,b.default)(p.ERR_COURSENAME).attr("display","block");(0,b.default)(p.ERR_COURSENAME).show();j=!1}else{(0,b.default)(p.ERR_COURSENAME).text("")}if(0==c.length){(0,b.default)(p.ERR_SHORTNAME).text("Please enter a short name for the course");(0,b.default)(p.ERR_SHORTNAME).attr("display","block");(0,b.default)(p.ERR_SHORTNAME).show();j=!1}else{(0,b.default)(p.ERR_SHORTNAME).text("")}var k=new Date(f+"."+e+"."+d).getTime()/1e3,l=new Date(g+"."+i+"."+h).getTime()/1e3;if(l<k&&(0,b.default)(p.ENDENABLE).is(":checked")){(0,b.default)(p.ERR_START).text("Course end date can not be before start date");(0,b.default)(p.ERR_START).attr("display","block");(0,b.default)(p.ERR_START).show();j=!1}else{(0,b.default)(p.ERR_START).text("");(0,b.default)(p.ERR_END).text("")}return j}},{key:"showMoreInfo",value:function showMoreInfo(a){var c="";b.default.each(self._templatelist,function(b,d){var e=a.attr("id").split("_");if(e[1]==d.id){c={id:d.id,fullname:d.fullname,summary:d.summary,courseimage:d.courseimage}}});d.default.create({type:d.default.types.DEFAULT,title:c.fullname,body:c.summary}).then(function(a){a.show()})}},{key:"createCourse",value:function createCourse(){if(!self._courseid){return}var a=(0,b.default)("div[data-role=\"templateholder\""),e=(0,b.default)(a).find(".active"),g=(0,b.default)(e).attr("id"),h=(0,b.default)(p.COURSENAME).val(),i=(0,b.default)(p.SHORTNAME).val(),j=(0,b.default)(p.CATEGORY).val(),k=(0,b.default)(p.STARTDAY).val(),l=(0,b.default)(p.STARTMONTH).val(),m=(0,b.default)(p.STARTYEAR).val(),n=(0,b.default)(p.STARTHOUR).val(),o=(0,b.default)(p.STARTMINUTE).val(),q="0";if((0,b.default)(p.ENDENABLE).is(":checked")){var r=(0,b.default)(p.ENDDAY).val(),s=(0,b.default)(p.ENDMONTH).val(),t=(0,b.default)(p.ENDYEAR).val(),u=(0,b.default)(p.ENDHOUR).val(),v=(0,b.default)(p.ENDMINUTE).val();q=r+"-"+s+"-"+t+"-"+u+"-"+v}self.spinnerCheck("show");var w={courseid:self._courseid,templateid:g,coursename:h,shortname:i,categoryid:j,startdate:k+"-"+l+"-"+m+"-"+n+"-"+o,enddate:q},x={methodname:"theme_urcourses_default_header_create_course",args:w,fail:f.default.exception},y=c.default.call([x]);y[0].done(function(a){self.spinnerCheck("hide");if(""!=a.error){var b=a.error;d.default.create({title:"ERROR:",body:"<p><b>"+b+"</b><br></p>"}).done(function(a){a.show()})}if(""!=a.url){window.location.href=a.url}}).fail(function(){self.spinnerCheck("hide")})}},{key:"duplicateCourse",value:function duplicateCourse(){if(!self._courseid){return}var a=(0,b.default)(p.COURSENAME).val(),e=(0,b.default)(p.SHORTNAME).val(),g=(0,b.default)(p.CATEGORY).val(),h=(0,b.default)(p.STARTDAY).val(),i=(0,b.default)(p.STARTMONTH).val(),j=(0,b.default)(p.STARTYEAR).val(),k=(0,b.default)(p.STARTHOUR).val(),l=(0,b.default)(p.STARTMINUTE).val(),m="0";if((0,b.default)(p.ENDENABLE).is(":checked")){var n=(0,b.default)(p.ENDDAY).val(),o=(0,b.default)(p.ENDMONTH).val(),q=(0,b.default)(p.ENDYEAR).val(),r=(0,b.default)(p.ENDHOUR).val(),s=(0,b.default)(p.ENDMINUTE).val();m=n+"-"+o+"-"+q+"-"+r+"-"+s}self.spinnerCheck("show");var t={courseid:self._courseid,coursename:a,shortname:e,categoryid:g,startdate:h+"-"+i+"-"+j+"-"+k+"-"+l,enddate:m},u={methodname:"theme_urcourses_default_header_duplicate_course",args:t,fail:f.default.exception},v=c.default.call([u]);v[0].done(function(a){self.spinnerCheck("hide");if(""!=a.error){if(""==a.user){var b="<p><b>"+a.error+"</b><br></p>"}else{var b="<div class=\"alert alert-warning\" role=\"alert\">"+a.error+"<b>"+a.user+".</b></div>"}d.default.create({title:"Notice:",body:b}).done(function(a){a.show()})}if(""!=a.url){window.location.href=a.url}}).fail(function(){self.spinnerCheck("hide")})}},{key:"spinnerCheck",value:function spinnerCheck(a){if((0,b.default)("#mainspinner").length){if("hide"==a){(0,b.default)("#mainspinner").hide();(0,b.default)("#infoholder").removeClass("block_urcourserequest_overlay")}else{(0,b.default)("#mainspinner").show();(0,b.default)("#infoholder").addClass("block_urcourserequest_overlay")}}}}]);return a}();a.default=q;return a.default});
//# sourceMappingURL=course_actions.min.js.map
