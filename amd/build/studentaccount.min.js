define("theme_urcourses_default/studentaccount",["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],(function($,ajax,notification,str,ModalFactory,ModalEvents){var BTN_STUDENT_ACCOUNT='#action-menu-0-menu a[data-title="studentaccount,theme_urcourses_default"]',_createStudentAction=function(){var infoarray=$(BTN_STUDENT_ACCOUNT).data("info").split(","),value=infoarray[1],username=infoarray[0];if(value)getStudentAccountInfo(username);else{var modalaction='<b>The following test user account will be created: </b><br><br><b>Email address </b><a class="btn btn-link p-0" role="button" data-toggle="modal" data-placement="right" data-target="moodle-email-modal-dialogue" data-html="true"><i class="icon fa fa-question-circle text-info fa-fw " title="Help with test student account email" aria-label="Help with test student account email"></i></a><br>'+username+"+urstudent@uregina.ca<br><br><b>Username </b><br>"+username+"-urstudent<hr/>You can enrol this account to test and experience a course as a student.<br><br><b>Would you like to create the test student account?</b><br>";ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Create a test student for UR Courses",body:"<p>"+modalaction+"</p>"}).then((function(modal){modal.setSaveButtonText("Create");var root=modal.getRoot();root.on(ModalEvents.cancel,(function(){})),$(root).find(".fa-question-circle").parent().click((function(){ModalFactory.create({type:ModalFactory.types.CANCEL,title:"Help with test student account email",body:"<p>Email sent to this address will appear in your username@uregina.ca inbox</p>"}).then((function(modal){modal.show()}))})),root.on(ModalEvents.save,(function(e){e.preventDefault(),$(root).find('button[data-action="save"]').append(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="sr-only">Loading...</span>'),_createStudentAccount(username)})),modal.show()}))}},getStudentAccountInfo=function(username){var ajaxCall={methodname:"theme_urcourses_default_test_account_info",args:{username:username},fail:notification.exception};ajax.call([ajaxCall])[0].done((function(data){var info="";info=0!=data.userid?'<b>Email address </b><a class="btn btn-link p-0" role="button" data-toggle="modal" data-placement="right" data-target="moodle-email-modal-dialogue" data-html="true"><i class="icon fa fa-question-circle text-info fa-fw " title="Help with test student account email" aria-label="Help with test student account email"></i></a><br>'+data.email+"<br><b>Username </b><br>"+data.username+"<br><b>Account Creation Date </b><br>"+data.datecreated+'<br/><br><div class="alert alert-warning d-flex justify-content-between bd-highlight " role="alert"><div class="">Reset test account password </div><button id="test_account_reset" type="button" class="btn btn-primary" >Reset Password</button></div>':'<div class="alert alert-warning" role="alert"> Test student account could not be found!</div>',ModalFactory.create({type:ModalFactory.types.CANCEL,title:"User details for test student account",body:info}).then((function(modal){var root=modal.getRoot();$(root).find('button[data-action="cancel"]').text("Close"),$(root).find(".fa-question-circle").parent().click((function(){ModalFactory.create({type:ModalFactory.types.CANCEL,title:"Help with test student account email",body:"<p>Email sent to this address will appear in your username@uregina.ca inbox</p>"}).then((function(modal){modal.show()}))})),root.on(ModalEvents.hidden,(function(){$("#test_account_reset").remove()})),modal.show()})).done((function(){$("#test_account_reset").bind("click",(function(){_resetStudentAccount($(this),username)}))}))}))},_createStudentAccount=function(username){var ajaxCall={methodname:"theme_urcourses_default_create_test_account",args:{username:username},fail:notification.exception};ajax.call([ajaxCall])[0].done((function(response){_studentAccountResponse(response)}))},_studentAccountResponse=function(data){var title="",info="";void 0!==data.unenroll?(title="Success: ",info='<div class="alert alert-success" role="alert">'+data.username+" was removed from course. </div>",data.unenroll||(title="ERROR:",info='<div class="alert alert-warning" role="alert">',info+=data.username+" could not be removed from course. </div>")):void 0!==data.reset?(title="Success: ",info='<div class="alert alert-success" role="alert">'+data.username+" password was reset. You will recieve an email with new credentials. It may take a few minutes to process.</div>",data.reset||0==data.userid?data.reset||0!=data.userid||(title="ERROR:",info='<div class="alert alert-warning" role="alert">',info+=data.username+"'s account could not be found </div>"):(title="ERROR:",info='<div class="alert alert-warning" role="alert">',info+=data.username+"'s password could not be reset, email failed to send </div>")):(title="Success: ",info='<div class="alert alert-success" role="alert">',0!=data.created&&0!=data.enrolled?info+=data.username+" was created. New account information has been emailed to you. </div>":0!=data.created&&0==data.enrolled?info+=data.username+" was created.New account information has been emailed to you. </div>":0==data.created&&0!=data.enrolled?info+=data.username+".</div>":(title="ERROR:",info='<div class="alert alert-warning" role="alert">',info+=data.username+" already exists.</div>")),ModalFactory.create({type:ModalFactory.types.CANCEL,title:title,body:info}).then((function(modal){var root=modal.getRoot();$(root).find('button[data-action="cancel"]').text("Close"),root.on(ModalEvents.cancel,(function(){void 0===data.reset&&location.reload()})),root.find(".close").click((function(){void 0===data.reset&&location.reload()})),modal.show()}))},_resetStudentAccount=function(e,username){var modalaction="reset the password for student account "+username+"+urstudent@uregina.ca.";ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Reset Password for test student account",body:"<p><b>Do you want to "+modalaction+"?</b><br /></p>"}).then((function(modal){modal.setSaveButtonText("Reset Password");var root=modal.getRoot();root.on(ModalEvents.cancel,(function(){})),root.on(ModalEvents.save,(function(e){e.preventDefault(),$(root).find('button[data-action="save"]').append('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="sr-only">Loading...</span>');var ajaxCall={methodname:"theme_urcourses_default_reset_test_account",args:{username:username},fail:notification.exception};ajax.call([ajaxCall])[0].done((function(response){$(root).find('button[data-action="cancel"]').click(),_studentAccountResponse(response)}))})),modal.show()}))};return{init:function(){var salink=$(BTN_STUDENT_ACCOUNT);salink.click((function(event){event.preventDefault()})),$(salink).on("click",_createStudentAction)}}}));

//# sourceMappingURL=studentaccount.min.js.map